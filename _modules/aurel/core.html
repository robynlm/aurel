

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>aurel.core &mdash; aurel May 2025 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=5a7fad61" />

  
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=8d170800"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            aurel
              <img src="../../_static/aurel.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../source/readme_sections.html">Key Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/readme_sections.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/readme_sections.html#getting-started">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/readme_sections.html#citation">Citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/advice.html">Working on an HPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/advice.html#convergence">Convergence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/CONTRIBUTING.html">Reporting Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/CONTRIBUTING.html#code-contributions">Code Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/CONTRIBUTING.html#license">License</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../source/core.html">aurel.core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/coresymbolic.html">aurel.coresymbolic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/finitedifference.html">aurel.finitedifference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/maths.html">aurel.maths</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/numerical.html">aurel.numerical</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/reading.html">aurel.reading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/time.html">aurel.time</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/solutions.html">aurel.solutions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Example.html">Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Example_symbolic.html">Example symbolic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Example_over_time.html">Example over time</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/tov_ET.html">tov_ET</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/ICPertFLRW.html">ICPertFLRW</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Schwarzschild_check.html">Schwarzschild check</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Analytic_check.html">Analytic check</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Gravitational_Waves.html">Gravitational Waves</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">aurel</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">aurel.core</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for aurel.core</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">core.py</span>

<span class="sd">This module is the main event. It contains:</span>
<span class="sd"> - **descriptions**, a dictionary of all the variables used in the aurel </span>
<span class="sd">   project</span>
<span class="sd"> - **AurelCore**, the main class responsible for managing the</span>
<span class="sd">   **AurelCore.data** dictionary. For an input spacetime and matter </span>
<span class="sd">   distribution, AurelCore can automatically retrieve any relativistic </span>
<span class="sd">   variable listed in the descriptions dictionary.</span>
<span class="sd">   This class has many attributes and functions, a</span>
<span class="sd">   large part of which are listed in the descriptions dictionary, </span>
<span class="sd">   but also many other tensor calculus functions.</span>
<span class="sd">   The descriptions functions are called as:</span>
<span class="sd">   </span>
<span class="sd">      - **AurelCore.variable_name()** for the function itself</span>
<span class="sd">      - **AurelCore.data[&quot;variable_name&quot;]** for the dictionary element,</span>
<span class="sd">        which is the same as calling the function but then</span>
<span class="sd">        saves it in the AurelCore.data dictionary.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Latex</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">maths</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">numerical</span>
<span class="n">is_notebook</span> <span class="o">=</span> <span class="s1">&#39;ipykernel&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span>

<span class="c1"># Descriptions for each AurelCore.data entry and function</span>
<span class="c1"># assumed variables need to be listed in docs/source/source/generate_rst.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">assumption</span><span class="p">(</span><span class="n">keyname</span><span class="p">,</span> <span class="n">assumption</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print assumption message.&quot;&quot;&quot;</span>
    <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; I assume &quot;</span> <span class="o">+</span> <span class="n">assumption</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
               <span class="o">+</span> <span class="s2">&quot;if not then please define &quot;</span>
               <span class="o">+</span> <span class="s2">&quot;AurelCore.data[&#39;&quot;</span><span class="o">+</span><span class="n">keyname</span><span class="o">+</span><span class="s2">&quot;&#39;] = ... &quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">message</span>
<span class="n">descriptions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># === Metric quantities</span>
    <span class="c1"># Full metric</span>
    <span class="s2">&quot;gtt&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$g_</span><span class="si">{tt}</span><span class="s2">$ Metric with tt indices down.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gtx&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$g_</span><span class="si">{tx}</span><span class="s2">$ Metric with tx indices down.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gty&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$g_</span><span class="si">{ty}</span><span class="s2">$ Metric with ty indices down.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gtz&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$g_</span><span class="si">{tz}</span><span class="s2">$ Metric with tz indices down.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gxx&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$g_</span><span class="si">{xx}</span><span class="s2">$ Metric with xx indices down.&quot;</span> 
        <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;gxx&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$g_</span><span class="si">{xx}</span><span class="s2">=1$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;gxy&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$g_</span><span class="si">{xy}</span><span class="s2">$ Metric with xy indices down.&quot;</span> 
        <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;gxy&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$g_</span><span class="si">{xy}</span><span class="s2">=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;gxz&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$g_</span><span class="si">{xz}</span><span class="s2">$ Metric with xz indices down.&quot;</span> 
        <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;gxz&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$g_</span><span class="si">{xz}</span><span class="s2">=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;gyy&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$g_</span><span class="si">{yy}</span><span class="s2">$ Metric with yy indices down.&quot;</span> 
        <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;gyy&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$g_</span><span class="si">{yy}</span><span class="s2">=1$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;gyz&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$g_</span><span class="si">{yz}</span><span class="s2">$ Metric with yz indices down.&quot;</span> 
        <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;gyz&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$g_</span><span class="si">{yz}</span><span class="s2">=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;gzz&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$g_</span><span class="si">{zz}</span><span class="s2">$ Metric with zz indices down.&quot;</span> 
        <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;gzz&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$g_</span><span class="si">{zz}</span><span class="s2">=1$&quot;</span><span class="p">)),</span>
    <span class="c1"># Spatial metric</span>
    <span class="s2">&quot;gammadown3&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\gamma_</span><span class="si">{ij}</span><span class="s2">$ Spatial metric with spatial indices down&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gammaup3&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\gamma^</span><span class="si">{ij}</span><span class="s2">$ Spatial metric with spatial indices up&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dtgammaup3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\partial_t \gamma^</span><span class="si">{ij}</span><span class="s2">$ Coordinate time derivative of&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; spatial metric with spatial indices up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;gammadet&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\gamma$ Determinant of spatial metric&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gammadown4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\gamma_{\mu\nu}$ Spatial metric with spacetime indices&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;gammaup4&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\gamma^{\mu\nu}$ Spatial metric with spacetime indices up&quot;</span><span class="p">,</span>
    <span class="c1"># BSSNOK metric</span>
    <span class="s2">&quot;psi_bssnok&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\psi = \gamma^{1/12}$ BSSNOK conformal factor&quot;</span><span class="p">,</span>
    <span class="s2">&quot;phi_bssnok&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\phi = \ln(\gamma^{1/12})$ BSSNOK conformal factor&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dtphi_bssnok&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\partial_t \phi$ Coordinate time derivative of BSSNOK&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; $\phi$ conformal factor&quot;</span><span class="p">),</span>
    <span class="s2">&quot;gammadown3_bssnok&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\tilde{\gamma}_</span><span class="si">{ij}</span><span class="s2">$ Conformal spatial metric&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;gammaup3_bssnok&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\tilde{\gamma}^</span><span class="si">{ij}</span><span class="s2">$ Conformal spatial metric&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spatial indices up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;dtgammadown3_bssnok&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\partial_t \tilde{\gamma}_</span><span class="si">{ij}</span><span class="s2">$ Coordinate&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; time derivative of conformal spatial metric with spatial&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; indices down&quot;</span><span class="p">),</span>
    <span class="c1"># Extrinsic curvature</span>
    <span class="s2">&quot;kxx&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$K_</span><span class="si">{xx}</span><span class="s2">$ Extrinsic curvature with xx indices down.&quot;</span> 
        <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;kxx&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$K_</span><span class="si">{xx}</span><span class="s2">=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;kxy&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$K_</span><span class="si">{xy}</span><span class="s2">$ Extrinsic curvature with xy indices down.&quot;</span> 
        <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;kxy&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$K_</span><span class="si">{xy}</span><span class="s2">=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;kxz&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$K_</span><span class="si">{xz}</span><span class="s2">$ Extrinsic curvature with xz indices down.&quot;</span> 
        <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;kxz&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$K_</span><span class="si">{xz}</span><span class="s2">=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;kyy&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$K_</span><span class="si">{yy}</span><span class="s2">$ Extrinsic curvature with yy indices down.&quot;</span> 
        <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;kyy&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$K_</span><span class="si">{yy}</span><span class="s2">=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;kyz&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$K_</span><span class="si">{yz}</span><span class="s2">$ Extrinsic curvature with yz indices down.&quot;</span> 
        <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;kyz&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$K_</span><span class="si">{yz}</span><span class="s2">=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;kzz&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$K_</span><span class="si">{zz}</span><span class="s2">$ Extrinsic curvature with zz indices down.&quot;</span> 
        <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;kzz&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$K_</span><span class="si">{zz}</span><span class="s2">=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;Kdown3&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$K_</span><span class="si">{ij}</span><span class="s2">$ Extrinsic curvature with spatial indices down&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Kup3&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$K^</span><span class="si">{ij}</span><span class="s2">$ Extrinsic curvature with spatial indices up&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Ktrace&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$K = \gamma^</span><span class="si">{ij}</span><span class="s2">K_</span><span class="si">{ij}</span><span class="s2">$ Trace of extrinsic curvature&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dtKtrace&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\partial_t K$ Coordinate time derivative of the&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; trace of extrinsic curvature&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Adown3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$A_</span><span class="si">{ij}</span><span class="s2">$ Traceless part of the extrinsic curvature&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Aup3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$A^</span><span class="si">{ij}</span><span class="s2">$ Traceless part of the extrinsic curvature&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spatial indices up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;A2&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$A^2$ Magnitude of traceless part of the extrinsic curvature&quot;</span><span class="p">,</span>
    <span class="c1"># BSSN extrinsic curvature</span>
    <span class="s2">&quot;Adown3_bssnok&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\tilde</span><span class="si">{A}</span><span class="s2">_</span><span class="si">{ij}</span><span class="s2">$ Conformal traceless part of the&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; extrinsic curvature with spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Aup3_bssnok&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\tilde</span><span class="si">{A}</span><span class="s2">^</span><span class="si">{ij}</span><span class="s2">$ Conformal traceless part of the&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; extrinsic curvature with spatial indices up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;A2_bssnok&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\tilde</span><span class="si">{A}</span><span class="s2">^2$ Magnitude of conformal traceless&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; part of the extrinsic curvature&quot;</span><span class="p">),</span>
    <span class="s2">&quot;dtAdown3_bssnok&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\partial_t \tilde</span><span class="si">{A}</span><span class="s2">_</span><span class="si">{ij}</span><span class="s2">$ Coordinate time&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; derivative of conformal traceless part of the extrinsic&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; curvature with spatial indices down&quot;</span><span class="p">),</span>
    <span class="c1"># Lapse</span>
    <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\alpha$ Lapse.&quot;</span> <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\alpha=1$&quot;</span><span class="p">),</span>
    <span class="s2">&quot;dtalpha&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\partial_t \alpha$ Coordinate time derivative&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; of the lapse.&quot;</span> <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;dtalpha&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\partial_t \alpha=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;DDalpha&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;D_iD_j\alpha$ Spatial covariant second&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; derivative of the lapse with spatial indices down&quot;</span><span class="p">),</span>
    <span class="c1"># Shift</span>
    <span class="s2">&quot;betax&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\beta^</span><span class="si">{x}</span><span class="s2">$ x component of the shift vector with indices up.&quot;</span> 
        <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;betax&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\beta^</span><span class="si">{x}</span><span class="s2">=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;betay&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\beta^</span><span class="si">{y}</span><span class="s2">$ y component of the shift vector with indices up.&quot;</span> 
        <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;betay&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\beta^</span><span class="si">{y}</span><span class="s2">=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;betaz&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\beta^</span><span class="si">{z}</span><span class="s2">$ z component of the shift vector with indices up.&quot;</span> 
        <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;betaz&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\beta^</span><span class="si">{z}</span><span class="s2">=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;betaup3&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\beta^</span><span class="si">{i}</span><span class="s2">$ Shift vector with spatial indices up&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dtbetax&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\partial_t\beta^</span><span class="si">{x}</span><span class="s2">$ Coordinate time derivative of the&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; x component of the shift vector with indices up.&quot;</span> 
        <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;dtbetax&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\partial_t\beta^</span><span class="si">{x}</span><span class="s2">=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;dtbetay&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\partial_t\beta^</span><span class="si">{y}</span><span class="s2">$ Coordinate time derivative of the&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; y component of the shift vector with indices up.&quot;</span> 
        <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;dtbetay&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\partial_t\beta^</span><span class="si">{y}</span><span class="s2">=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;dtbetaz&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\partial_t\beta^</span><span class="si">{z}</span><span class="s2">$ Coordinate time derivative of the&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; z component of the shift vector with indices up.&quot;</span> 
        <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;dtbetaz&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\partial_t\beta^</span><span class="si">{z}</span><span class="s2">=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;dtbetaup3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\partial_t\beta^</span><span class="si">{i}</span><span class="s2">$ Coordinate time derivative&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; of the shift vector with spatial indices up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;betadown3&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\beta_</span><span class="si">{i}</span><span class="s2">$ Shift vector with spatial indices down&quot;</span><span class="p">,</span>
    <span class="s2">&quot;betamag&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\beta_</span><span class="si">{i}</span><span class="s2">\beta^</span><span class="si">{i}</span><span class="s2">$ Magnitude of shift vector&quot;</span><span class="p">,</span>
    <span class="c1"># Proper time</span>
    <span class="s2">&quot;dttau&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\partial_t \tau$ Coordinate time derivative of proper time&quot;</span><span class="p">,</span>
    <span class="c1"># Timelike normal vector</span>
    <span class="s2">&quot;nup4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$n^{\mu}$ Timelike vector normal to the spatial metric&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spacetime indices up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;ndown4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$n_{\mu}$ Timelike vector normal to the spatial metric&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spacetime indices down&quot;</span><span class="p">),</span>
    <span class="c1"># Spacetime metric</span>
    <span class="s2">&quot;gdown4&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$g_{\mu\nu}$ Spacetime metric with spacetime indices down&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gup4&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$g^{\mu\nu}$ Spacetime metric with spacetime indices up&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gdet&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$g$ Determinant of spacetime metric&quot;</span><span class="p">,</span>
    <span class="c1"># Null ray expansion</span>
    <span class="s2">&quot;null_ray_exp_out&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Theta_</span><span class="si">{out}</span><span class="s2">$ List of expansion of&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; null rays radially going out&quot;</span><span class="p">),</span>
    <span class="s2">&quot;null_ray_exp_in&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Theta_</span><span class="si">{in}</span><span class="s2">$ List of expansion of&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; null rays radially going in&quot;</span><span class="p">),</span>

    <span class="c1"># === Matter quantities</span>
    <span class="c1"># Eulerian observer follows n^mu</span>
    <span class="c1"># Lagrangian observer follows u^mu</span>
    <span class="s2">&quot;rho0&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\rho_0$ Rest mass energy density.&quot;</span>
        <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;rho0&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\rho_0=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;press&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$p$ Pressure.&quot;</span> <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;press&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$p=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;eps&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\epsilon$ Specific internal energy.&quot;</span>
        <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;eps&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\epsilon=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;rho&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\rho$ Energy density&quot;</span><span class="p">,</span>
    <span class="s2">&quot;enthalpy&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$h$ Specific enthalpy of the fluid&quot;</span><span class="p">,</span>
    <span class="c1"># Fluid velocity</span>
    <span class="s2">&quot;w_lorentz&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$W$ Lorentz factor.&quot;</span> <span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;w_lorentz&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$W=1$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;velx&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$v^x$ x component of Eulerian fluid three velocity&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with indice up.&quot;</span><span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;velx&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$v^x=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;vely&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$v^y$ y component of Eulerian fluid three velocity&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with indice up.&quot;</span><span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;vely&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$v^y=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;velz&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$v^z$ z component of Eulerian fluid three velocity&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with indice up.&quot;</span><span class="o">+</span> <span class="n">assumption</span><span class="p">(</span><span class="s1">&#39;velz&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$v^z=0$&quot;</span><span class="p">)),</span>
    <span class="s2">&quot;velup3&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$v^i$ Eulerian fluid three velocity with spatial indices up.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;velup4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$v^\mu$ Eulerian fluid three velocity&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spacetime indices up.&quot;</span><span class="p">),</span>
    <span class="s2">&quot;veldown3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$v_i$ Eulerian fluid three velocity&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;veldown4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$v_\mu$ Eulerian fluid three velocity&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spacetime indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;uup0&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$u^t$ Lagrangian fluid four velocity with time indice up&quot;</span><span class="p">,</span>
    <span class="s2">&quot;uup3&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$u^i$ Lagrangian fluid four velocity with spatial indices up&quot;</span><span class="p">,</span>
    <span class="s2">&quot;uup4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$u^\mu$ Lagrangian fluid four velocity&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spacetime indices up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;udown3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$u_\mu$ Lagrangian fluid four velocity&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;udown4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$u_\mu$ Lagrangian fluid four velocity&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spacetime indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;hdown4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$h_{\mu\nu}$ Spatial metric orthonomal to fluid flow&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spacetime indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;hdet&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$h$ Determinant of spatial part of spatial metric orthonormal&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; to fluid flow&quot;</span><span class="p">),</span>
    <span class="s2">&quot;hmixed4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;${h^{\mu}}_{\nu}$ Spatial metric orthonomal to fluid flow&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with mixed spacetime indices&quot;</span><span class="p">),</span>
    <span class="s2">&quot;hup4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$h^{\mu\nu}$ Spatial metric orthonomal to fluid flow&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spacetime indices up&quot;</span><span class="p">),</span>
    <span class="c1"># Energy-stress tensor</span>
    <span class="s2">&quot;Tdown4&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$T_{\mu\nu}$ Energy-stress tensor with spacetime indices down&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Tup4&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$T^{\mu\nu}$ Energy-stress tensor with spacetime indices up&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Ttrace&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$T$ Trace of the energy-stress tensor&quot;</span><span class="p">,</span>
    <span class="c1"># Fluid quantities in Eulerian frame</span>
    <span class="s2">&quot;rho_n&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\rho^{\{n\}}$ Energy density in the $n^\mu$ frame&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fluxup3_n&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$S^{\{n\}i}$ Energy flux (or momentum density) in the&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; $n^\mu$ frame with spatial indices up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;fluxdown3_n&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$S^{\{n\}}_</span><span class="si">{i}</span><span class="s2">$ Energy flux (or momentum density) in&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; the $n^\mu$ frame with spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;angmomup3_n&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$J^{\{n\}i}$ Angular momentum density&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; in the $n^\mu$ frame with spatial indices up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;angmomdown3_n&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$J^{\{n\}}_</span><span class="si">{i}</span><span class="s2">$ Angular momentum density&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; in the $n^\mu$ frame with spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Stressup3_n&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$S^{\{n\}ij}$ Stress tensor in the $n^\mu$ frame&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spatial indices up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Stressdown3_n&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$S^{\{n\}}_</span><span class="si">{ij}</span><span class="s2">$ Stress tensor in the $n^\mu$ frame&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Stresstrace_n&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$S^{\{n\}}$ Trace of Stress tensor&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; in the $n^\mu$ frame&quot;</span><span class="p">),</span>
    <span class="s2">&quot;press_n&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$p^{\{n\}}$ Pressure in the $n^\mu$ frame&quot;</span><span class="p">,</span>
    <span class="s2">&quot;anisotropic_press_down3_n&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\pi^{\{n\}_</span><span class="si">{ij}</span><span class="s2">}$ Anisotropic pressure&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; in the $n^\mu$ frame with spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;rho_n_fromHam&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\rho^{\{n\}}$ Energy density in the $n^\mu$ frame&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; computed from the Hamiltonian constraint&quot;</span><span class="p">),</span>
    <span class="s2">&quot;fluxup3_n_fromMom&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$S^{\{n\}i}$ Energy flux (or momentum density) in&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; the $n^\mu$ frame with spatial indices up computed from&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; the Momentum constraint&quot;</span><span class="p">),</span>
    <span class="c1"># Conserved quantities</span>
    <span class="s2">&quot;conserved_D&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$D$ Conserved mass-energy density in Wilson&#39;s formalism&quot;</span><span class="p">,</span>
    <span class="s2">&quot;conserved_E&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$E$ Conserved internal energy density&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; in Wilson&#39;s formalism&quot;</span><span class="p">),</span>
    <span class="s2">&quot;conserved_Sdown4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$S_{\mu}$ Conserved energy flux&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; (or momentum density) in Wilson&#39;s formalism&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spacetime indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;conserved_Sdown3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$S_</span><span class="si">{i}</span><span class="s2">$ Conserved energy flux (or momentum density)&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; in Wilson&#39;s formalism with spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;conserved_Sup4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$S^{\mu}$ Conserved energy flux (or momentum density)&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; in Wilson&#39;s formalism with spacetime indices up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;conserved_Sup3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$S^</span><span class="si">{i}</span><span class="s2">$ Conserved energy flux (or momentum density)&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; in Wilson&#39;s formalism with spatial indices up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;dtconserved&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\partial_t D, \; \partial_t E, \partial_t S_</span><span class="si">{i}</span><span class="s2">$&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; List of coordinate time derivatives of conserved&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; rest mass-energy density, internal energy density&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; and energy flux (or momentum density)&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spatial indices down in Wilson&#39;s formalism&quot;</span><span class="p">),</span>
    <span class="c1"># Kinematics</span>
    <span class="s2">&quot;st_covd_udown4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\nabla_{\mu} u_{\nu}$ Spacetime covariant derivative&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; of Lagrangian fluid four velocity with spacetime indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;accelerationdown4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$a_{\mu}$ Acceleration of the fluid&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spacetime indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;accelerationup4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$a^{\mu}$ Acceleration of the fluid&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spacetime indices up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;s_covd_udown4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathcal</span><span class="si">{D}</span><span class="s2">^{\{u\}}_{\mu} u_{\nu}$ Spatial covariant&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; derivative of Lagrangian fluid four velocity with spacetime&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; indices down, with respect to spatial hypersurfaces orthonormal&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; to the fluid flow&quot;</span><span class="p">),</span>
    <span class="s2">&quot;thetadown4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Theta_{\mu\nu}$ Fluid expansion tensor&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spacetime indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;theta&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\Theta$ Fluid expansion scalar&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sheardown4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\sigma_{\mu\nu}$ Fluid shear tensor&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spacetime indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;shear2&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\sigma^2$ Magnitude of fluid shear&quot;</span><span class="p">,</span>
    <span class="s2">&quot;omegadown4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\omega_{\mu\nu}$ Fluid vorticity tensor&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spacetime indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;omega2&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\omega^2$ Magnitude of fluid vorticity&quot;</span><span class="p">,</span>
    <span class="s2">&quot;s_RicciS_u&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$</span><span class="si">{}</span><span class="s2">^{(3)}R^{\{u\}}$ Ricci scalar of the spatial metric&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; orthonormal to fluid flow&quot;</span><span class="p">),</span>

    <span class="c1"># === Curvature quantities</span>
    <span class="c1"># of spatial metric</span>
    <span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$</span><span class="si">{}</span><span class="s2">^{(3)}{\Gamma^</span><span class="si">{k}</span><span class="s2">}_</span><span class="si">{ij}</span><span class="s2">$ Christoffel symbols of&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; spatial metric with mixed spatial indices&quot;</span><span class="p">),</span>
    <span class="s2">&quot;s_Riemann_uddd3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$</span><span class="si">{}</span><span class="s2">^{(3)}{R^</span><span class="si">{i}</span><span class="s2">}_</span><span class="si">{jkl}</span><span class="s2">$ Riemann tensor of&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; spatial metric with mixed spatial indices&quot;</span><span class="p">),</span>
    <span class="s2">&quot;s_Riemann_down3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$</span><span class="si">{}</span><span class="s2">^{(3)}R_</span><span class="si">{ijkl}</span><span class="s2">$ Riemann tensor of spatial metric&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with all spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;s_Ricci_down3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$</span><span class="si">{}</span><span class="s2">^{(3)}R_</span><span class="si">{ij}</span><span class="s2">$ Ricci tensor of spatial metric&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;s_RicciS&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$</span><span class="si">{}</span><span class="s2">^{(3)}R$ Ricci scalar of spatial metric&quot;</span><span class="p">,</span>
    <span class="c1"># of spacetime metric</span>
    <span class="s2">&quot;st_Gamma_udd4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$</span><span class="si">{}</span><span class="s2">^{(4)}{\Gamma^{\alpha}}_{\mu\nu}$ Christoffel&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; symbols of spacetime metric with mixed spacetime indices&quot;</span><span class="p">),</span>
    <span class="s2">&quot;st_Riemann_uddd4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$</span><span class="si">{}</span><span class="s2">^{(4)}{R^{\alpha}}_{\beta\mu\nu}$ Riemann&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; tensor of spacetime metric with mixed spacetime indices&quot;</span><span class="p">),</span>
    <span class="s2">&quot;st_Riemann_down4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$</span><span class="si">{}</span><span class="s2">^{(4)}R_{\alpha\beta\mu\nu}$ Riemann tensor&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; of spacetime metric with spacetime indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;st_Riemann_uudd4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$</span><span class="si">{}</span><span class="s2">^{(4)}{R^{\alpha\beta}}_{\mu\nu}$ Riemann&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; tensor of spacetime metric with mixed spacetime indices&quot;</span><span class="p">),</span>
    <span class="s2">&quot;st_Ricci_down4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$</span><span class="si">{}</span><span class="s2">^{(4)}R_{\alpha\beta}$ Ricci tensor of spacetime&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; metric with spacetime indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;st_Ricci_down3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$</span><span class="si">{}</span><span class="s2">^{(4)}R_</span><span class="si">{ij}</span><span class="s2">$ Ricci tensor of spacetime metric&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;st_RicciS&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$</span><span class="si">{}</span><span class="s2">^{(4)}R$ Ricci scalar of spacetime metric&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Einsteindown4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$G_{\alpha\beta}$ Einstein tensor with spacetime&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Kretschmann&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$K={R^{\alpha\beta}}_{\mu\nu}{R_{\alpha\beta}}^{\mu\nu}$&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; Kretschmann scalar&quot;</span><span class="p">),</span>
    <span class="c1"># in BSSNOK form</span>
    <span class="s2">&quot;s_Gamma_udd3_bssnok&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$</span><span class="si">{}</span><span class="s2">^{(3)}{\tilde{\Gamma}^</span><span class="si">{k}</span><span class="s2">}_</span><span class="si">{ij}</span><span class="s2">$ Christoffel&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; symbols of conformal spatial metric with mixed spatial indices&quot;</span><span class="p">),</span>
    <span class="s2">&quot;s_Gamma_bssnok&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$</span><span class="si">{}</span><span class="s2">^{(3)}\tilde{\Gamma}^i$ Conformal connection&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; functions with spatial indice up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;dts_Gamma_bssnok&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\partial_t </span><span class="si">{}</span><span class="s2">^{(3)}\tilde{\Gamma}^i$&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; Coordinate time derivative of conformal connection functions&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spatial indice up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;s_Ricci_down3_bssnok&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$</span><span class="si">{}</span><span class="s2">^{(3)}\tilde</span><span class="si">{R}</span><span class="s2">_</span><span class="si">{ij}</span><span class="s2">$ Ricci tensor of&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; conformal spatial metric with spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;s_RicciS_bssnok&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$</span><span class="si">{}</span><span class="s2">^{(3)}\tilde</span><span class="si">{R}</span><span class="s2">$ Ricci scalar of conformal&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; spatial metric&quot;</span><span class="p">),</span>
    <span class="s2">&quot;s_Ricci_down3_phi&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$</span><span class="si">{}</span><span class="s2">^{(3)}R^{\phi}_</span><span class="si">{ij}</span><span class="s2">$ Ricci terms that depend on the&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; conformal function $\phi$&quot;</span><span class="p">),</span>
    <span class="c1"># Constraints</span>
    <span class="s2">&quot;Hamiltonian&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;$\mathcal</span><span class="si">{H}</span><span class="s2">$ Hamilonian constraint&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Hamiltonian_Escale&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[$\mathcal</span><span class="si">{H}</span><span class="s2">$] Hamilonian constraint&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; energy scale&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Hamiltonian_norm&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathcal</span><span class="si">{H}</span><span class="s2">/[\mathcal</span><span class="si">{H}</span><span class="s2">]$ Normalized Hamilonian&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; constraint&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Momentumx&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathcal</span><span class="si">{M}</span><span class="s2">^x$ Momentum constraint&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with x spatial indices up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Momentumy&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathcal</span><span class="si">{M}</span><span class="s2">^y$ Momentum constraint&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with y spatial indices up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Momentumz&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathcal</span><span class="si">{M}</span><span class="s2">^z$ Momentum constraint&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with z spatial indices up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Momentumdownx&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathcal</span><span class="si">{M}</span><span class="s2">_x$ Momentum constraint&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with x spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Momentumdowny&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathcal</span><span class="si">{M}</span><span class="s2">_y$ Momentum constraint&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with y spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Momentumdownz&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathcal</span><span class="si">{M}</span><span class="s2">_z$ Momentum constraint&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with z spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Momentumup3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathcal</span><span class="si">{M}</span><span class="s2">^i$ Momentum constraint&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spatial indices up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Momentumdown3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathcal</span><span class="si">{M}</span><span class="s2">_i$ Momentum constraint&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Momentum_Escale&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[$\mathcal</span><span class="si">{M}</span><span class="s2">$] Momentum constraint&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; energy scale&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Momentumx_norm&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathcal</span><span class="si">{M}</span><span class="s2">^x/[\mathcal</span><span class="si">{M}</span><span class="s2">]$ Normalized Momentum&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; constraint with x spatial indices up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Momentumy_norm&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathcal</span><span class="si">{M}</span><span class="s2">^y/[\mathcal</span><span class="si">{M}</span><span class="s2">]$ Normalized Momentum&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; constraint with y spatial indices up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Momentumz_norm&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathcal</span><span class="si">{M}</span><span class="s2">^z/[\mathcal</span><span class="si">{M}</span><span class="s2">]$ Normalized Momentum&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; constraint with z spatial indices up&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Momentumdownx_norm&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathcal</span><span class="si">{M}</span><span class="s2">_x/[\mathcal</span><span class="si">{M}</span><span class="s2">]$ Normalized Momentum&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; constraint with x spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Momentumdowny_norm&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathcal</span><span class="si">{M}</span><span class="s2">_y/[\mathcal</span><span class="si">{M}</span><span class="s2">]$ Normalized Momentum&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; constraint with y spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Momentumdownz_norm&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathcal</span><span class="si">{M}</span><span class="s2">_z/[\mathcal</span><span class="si">{M}</span><span class="s2">]$ Normalized Momentum&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; constraint with z spatial indices down&quot;</span><span class="p">),</span>

    <span class="c1"># === Gravito-electromagnetism quantities</span>
    <span class="s2">&quot;st_Weyl_down4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$C_{\alpha\beta\mu\nu}$ Weyl tensor of spacetime&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; metric with spacetime indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Weyl_Psi&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Psi_0, \; \Psi_1, \; \Psi_2, \; \Psi_3, \; \Psi_4$&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; List of Weyl scalars for an null vector base defined&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with AurelCore.tetrad&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Psi4_lm&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Psi_4^{l,m}$ List of dictionaries of spin weighted&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; spherical harmonic decomposition of the 4th Weyl scalar.&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; Control with AurelCore.lmax, center, extract_radii, and&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; interp_method.&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Weyl_invariants&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$I, \; J, \; L, \; K, \; N$&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; Dictionary of Weyl invariants&quot;</span><span class="p">),</span>
    <span class="s2">&quot;eweyl_u_down4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$E^{\{u\}}_{\alpha\beta}$ Electric part of the Weyl&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; tensor on the hypersurface orthogonal to $u^{\mu}$&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spacetime indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;eweyl_n_down3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$E^{\{n\}}_</span><span class="si">{ij}</span><span class="s2">$ Electric part of the Weyl&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; tensor on the hypersurface orthogonal to $n^{\mu}$&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spatial indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;bweyl_u_down4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$B^{\{u\}}_{\alpha\beta}$ Magnetic part of the Weyl&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; tensor on the hypersurface orthogonal to $u^{\mu}$&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spacetime indices down&quot;</span><span class="p">),</span>
    <span class="s2">&quot;bweyl_n_down3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$B^{\{n\}}_</span><span class="si">{ij}</span><span class="s2">$ Magnetic part of the Weyl&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; tensor on the hypersurface orthogonal to $n^{\mu}$&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; with spatial indices down&quot;</span><span class="p">),</span>
<span class="p">}</span>
    
<span class="c1">###############################################################################</span>
<span class="c1"># Core class for aurel</span>
<span class="c1">###############################################################################</span>

<div class="viewcode-block" id="AurelCore">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AurelCore</span><span class="p">():</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Class able to calculate any variable in aurel.descriptions.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fd : FiniteDifference</span>
<span class="sd">        aurel.finitedifference.FiniteDifference</span>
<span class="sd">    verbose : bool</span>
<span class="sd">        If True, display messages about the calculations.</span>
<span class="sd">    fancy_print : bool</span>
<span class="sd">        If True, display messages in a fancy ipython format, </span>
<span class="sd">        else normal print is used. Default is True.</span>
<span class="sd">    clear_cache_every_nbr_calc : int</span>
<span class="sd">        Number of calculations before clearing the cache. Default is 20.</span>
<span class="sd">    memory_threshold_inGB : int</span>
<span class="sd">        Memory threshold in GB for clearing the cache. Default is 4 GB.</span>
<span class="sd">    Lambda : float, optional, also attribute</span>
<span class="sd">        Cosmological constant. Default is 0.0.</span>
<span class="sd">    vacuum : bool, optional, also attribute</span>
<span class="sd">        If True, assume vacuum spacetime (no matter). Default is False.</span>
<span class="sd">    tetrad : str, optional, also attribute</span>
<span class="sd">        Tetrad choice for Weyl scalar calculations.</span>
<span class="sd">        Default is &quot;quasi-Kinnersley&quot;. Any other value provides ...</span>
<span class="sd">    lmax : int, optional, also attribute</span>
<span class="sd">        Maximum l value for spherical harmonic decompositions. Default is 8.</span>
<span class="sd">    center : tuple, optional, also attribute</span>
<span class="sd">        Center of the Psi4_lm sphere.</span>
<span class="sd">        Default is (0.0, 0.0, 0.0).</span>
<span class="sd">    extract_radii : list, optional, also attribute</span>
<span class="sd">        List of extraction radii for spherical harmonic decompositions.</span>
<span class="sd">        Default is [0.9 * min radius in the grid].</span>
<span class="sd">    interp_method : str, optional, also attribute</span>
<span class="sd">        Interpolation method for </span>
<span class="sd">        `scipy.interpolate.RegularGridInterpolator &lt;https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.RegularGridInterpolator.html&gt;`_.</span>
<span class="sd">        Default is &#39;linear&#39;.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    param : dict</span>
<span class="sd">        (*dict*) - Dictionary containing the data grid parameters, from fd. </span>
<span class="sd">    data : dict</span>
<span class="sd">        (*dict*) - Dictionary where all the variables are stored.</span>
<span class="sd">    data_shape : tuple</span>
<span class="sd">        (*tuple*) - Shape of the data arrays: (Nx, Ny, Nz)</span>
<span class="sd">    kappa : float</span>
<span class="sd">        (*float*) - Einstein&#39;s constant with G = c = 1. Default is 8 * pi.</span>
<span class="sd">    calculation_count : int</span>
<span class="sd">        (*int*) - Number of calculations performed.</span>
<span class="sd">    last_accessed : dict</span>
<span class="sd">        (*dict*) - Dictionary to keep track of when each variable was </span>
<span class="sd">        last accessed.</span>
<span class="sd">    var_importance : dict</span>
<span class="sd">        (*dict*) - Dictionary to keep track of the importance of each variable</span>
<span class="sd">        for cache cleanup. To never delete a variable, set its importance to 0.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the AurelCore class.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">param</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">param</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fd</span> <span class="o">=</span> <span class="n">fd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Nx&#39;</span><span class="p">],</span> 
                           <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Ny&#39;</span><span class="p">],</span> 
                           <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Nz&#39;</span><span class="p">])</span>

        <span class="c1"># Kwargs or use defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fancy_print</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fancy_print&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_cache_every_nbr_calc</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;clear_cache_every_nbr_calc&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory_threshold_inGB</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;memory_threshold_inGB&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Lambda</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Lambda&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vacuum</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;vacuum&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tetrad</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tetrad&#39;</span><span class="p">,</span> <span class="s2">&quot;quasi-Kinnersley&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lmax&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="n">min_box_radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">xmin</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">xmax</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">ymin</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">ymax</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">zmin</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">zmax</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">]])))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extract_radii</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;extract_radii&#39;</span><span class="p">,</span> 
                                        <span class="p">[</span><span class="n">min_box_radius</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">])</span>
        <span class="c1"># Convert extract_radii to list if it&#39;s a single number</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extract_radii</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extract_radii</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">extract_radii</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">interp_method</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interp_method&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">)</span>
        
        <span class="c1"># Save any additional kwargs as attributes</span>
        <span class="n">handled_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Lambda&#39;</span><span class="p">,</span> <span class="s1">&#39;tetrad&#39;</span><span class="p">,</span> <span class="s1">&#39;lmax&#39;</span><span class="p">,</span> <span class="s1">&#39;extract_radii&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;interp_method&#39;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">handled_kwargs</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        
        <span class="c1"># Physics variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># Einstein&#39;s constant with G = c = 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cosmological constant set to AurelCore.Lambda&quot;</span>
                     <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Lambda</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># data dictionary where everything is stored</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># To clean up cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculation_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_accessed</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Importance of each variable for cache cleanup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_importance</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="mf">1.0</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">descriptions</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_importance</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.002</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_importance</span><span class="p">[</span><span class="s2">&quot;s_RicciS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span>

    <span class="c1">###########################################################################</span>
    <span class="c1"># Functions to manage the data dictionary</span>
    <span class="c1">###########################################################################</span>

<div class="viewcode-block" id="AurelCore.myprint">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.myprint">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">myprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print a message with a fancy format.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_notebook</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fancy_print</span><span class="p">:</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get data[key] or compute it if not present.&quot;&quot;&quot;</span>
        <span class="c1"># First check if the key is already cached</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="c1"># Update the last accessed time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_accessed</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_count</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        
        <span class="c1"># Dynamically get the function by name</span>
        <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

        <span class="c1"># Call the function if it takes no additional arguments</span>
        <span class="k">if</span> <span class="n">func</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_argcount</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>
            <span class="c1"># Print the calculation description if available</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calculated </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: &quot;</span> <span class="o">+</span> <span class="n">descriptions</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculation_count</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># Increment the calculation count</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_accessed</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_count</span> <span class="c1"># Update</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_cache</span><span class="p">()</span>  <span class="c1"># Clean the cache after each new calculation</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1"># Return the function itself if it requires arguments</span>
        <span class="k">return</span> <span class="n">func</span>
    
<div class="viewcode-block" id="AurelCore.cleanup_cache">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.cleanup_cache">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cleanup_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove old entries from the cache based on age and size.&quot;&quot;&quot;</span>
        <span class="n">regular_cleanup</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculation_count</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear_cache_every_nbr_calc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">total_cache_size</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> 
                               <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">memory_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_threshold_inGB</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
        <span class="n">memory_limit_exceeded</span> <span class="o">=</span> <span class="n">total_cache_size</span> <span class="o">&gt;=</span> <span class="n">memory_threshold</span>
        <span class="k">if</span> <span class="n">regular_cleanup</span> <span class="ow">or</span> <span class="n">memory_limit_exceeded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s1">&#39;CLEAN-UP: &#39;</span><span class="o">+</span>
                <span class="sa">f</span><span class="s2">&quot;Cleaning up cache after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">calculation_count</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; calculations...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s1">&#39;CLEAN-UP: &#39;</span><span class="o">+</span>
                <span class="sa">f</span><span class="s2">&quot;data size before cleanup: &quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total_cache_size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1_048_576</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>
            
            <span class="n">scalar_size</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Nx&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Ny&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Nz&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span>
            <span class="n">strain_tolerance</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clear_cache_every_nbr_calc</span> <span class="o">*</span> <span class="n">scalar_size</span><span class="p">)</span>
            
            <span class="n">key_to_remove</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">last_time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_accessed</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Calculate how many calculations ago </span>
                <span class="c1"># the data entry was last accessed</span>
                <span class="n">time_since_last_access</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_count</span> <span class="o">-</span> <span class="n">last_time</span>
                <span class="c1"># Get the size of the entry</span>
                <span class="n">data_size</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">time_since_last_access</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">importance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_importance</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                    <span class="n">strain</span> <span class="o">=</span> <span class="p">(</span><span class="n">time_since_last_access</span> <span class="o">*</span> <span class="n">data_size</span> 
                              <span class="o">*</span> <span class="n">importance</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">strain</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1"># Consider old entries and large entries for removal</span>
                <span class="k">if</span> <span class="n">strain</span> <span class="o">&gt;</span> <span class="n">strain_tolerance</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s1">&#39;CLEAN-UP: &#39;</span>
                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;Removing cached value for &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; used </span><span class="si">{</span><span class="n">time_since_last_access</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; calculations ago (size: &quot;</span>
                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1_048_576</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB).&quot;</span><span class="p">)</span>
                    <span class="n">key_to_remove</span> <span class="o">+=</span> <span class="p">[</span><span class="n">key</span><span class="p">]</span>
            
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">key_to_remove</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_accessed</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">nbr_keys_removed</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">key_to_remove</span><span class="p">)</span>

            <span class="c1"># if it&#39;s still too bog, then remove the most strain</span>
            <span class="n">total_cache_size</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> 
                                   <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="k">while</span> <span class="n">total_cache_size</span> <span class="o">&gt;=</span> <span class="n">memory_threshold</span><span class="p">:</span>
                <span class="n">maxstrain</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">last_time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_accessed</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">time_since_last_access</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation_count</span> <span class="o">-</span> <span class="n">last_time</span>
                    <span class="k">if</span> <span class="n">time_since_last_access</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">importance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_importance</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                        <span class="n">strain</span> <span class="o">=</span> <span class="p">(</span><span class="n">time_since_last_access</span> 
                                <span class="o">*</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> 
                                <span class="o">*</span> <span class="n">importance</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">strain</span> <span class="o">&gt;</span> <span class="n">maxstrain</span><span class="p">:</span>
                            <span class="n">maxstrain</span> <span class="o">=</span> <span class="n">strain</span>
                            <span class="n">key_to_remove</span> <span class="o">=</span> <span class="n">key</span>
                <span class="k">if</span> <span class="n">maxstrain</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s1">&#39;CLEAN-UP: &#39;</span>
                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;Current cache size &quot;</span>
                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total_cache_size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1_048_576</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB, &quot;</span>
                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;max memory &quot;</span>
                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">memory_threshold</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1_048_576</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s1">&#39;CLEAN-UP: &#39;</span>
                        <span class="o">+</span> <span class="s2">&quot;Max memory too small,&quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;no more unimportant cache to remove.&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s1">&#39;CLEAN-UP: &#39;</span>
                        <span class="o">+</span> <span class="s2">&quot;Current variables: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Remove the key with the maximum strain</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="n">calc_age</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calculation_count</span> 
                                    <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_accessed</span><span class="p">[</span><span class="n">key_to_remove</span><span class="p">])</span>
                        <span class="n">varsize</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key_to_remove</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s1">&#39;CLEAN-UP: &#39;</span><span class="o">+</span>
                            <span class="sa">f</span><span class="s2">&quot;Removing cached value for &#39;</span><span class="si">{</span><span class="n">key_to_remove</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;used </span><span class="si">{</span><span class="n">calc_age</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;calculations ago (size: &quot;</span>
                            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">varsize</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1_048_576</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB).&quot;</span><span class="p">)</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key_to_remove</span><span class="p">]</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_accessed</span><span class="p">[</span><span class="n">key_to_remove</span><span class="p">]</span>
                    <span class="n">nbr_keys_removed</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">total_cache_size</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> 
                                           <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s1">&#39;CLEAN-UP: &#39;</span><span class="o">+</span>
                         <span class="sa">f</span><span class="s2">&quot;Removed </span><span class="si">{</span><span class="n">nbr_keys_removed</span><span class="si">}</span><span class="s2"> items&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s1">&#39;CLEAN-UP: &#39;</span><span class="o">+</span>
                         <span class="sa">f</span><span class="s2">&quot;data size after cleanup: &quot;</span>
                         <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total_cache_size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1_048_576</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="AurelCore.load_data">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.load_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim_data</span><span class="p">,</span> <span class="n">iteration</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load simulation data into this classe&#39;s data dictionary, and freeze.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sim_data : dict</span>
<span class="sd">            Dictionary containing the simulation data, </span>
<span class="sd">            each key has a list of values for each iteration.</span>
<span class="sd">        iteration : int</span>
<span class="sd">            The iteration number to load data from.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">sim_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">iteration</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeze_data</span><span class="p">()</span></div>


<div class="viewcode-block" id="AurelCore.freeze_data">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.freeze_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">freeze_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Freeze the data dictionary to prevent cache removal.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var_importance</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div>


    <span class="c1">###########################################################################</span>
    <span class="c1"># Functions of the data dictionary</span>
    <span class="c1">###########################################################################</span>
        
    <span class="c1"># === Metric quantities</span>
    <span class="c1"># Full spacetime metric</span>
<div class="viewcode-block" id="AurelCore.gtt">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.gtt">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gtt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;gdown4&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betamag&quot;</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="AurelCore.gtx">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.gtx">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gtx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;gdown4&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betadown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="AurelCore.gty">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.gty">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;gdown4&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betadown3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="AurelCore.gtz">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.gtz">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gtz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;gdown4&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betadown3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="AurelCore.gxx">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.gxx">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gxx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;gammadown3&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.gxy">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.gxy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gxy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;gammadown3&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.gxz">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.gxz">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gxz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;gammadown3&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.gyy">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.gyy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gyy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;gammadown3&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.gyz">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.gyz">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gyz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;gammadown3&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.gzz">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.gzz">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gzz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;gammadown3&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>


    <span class="c1"># Spatial metric</span>
<div class="viewcode-block" id="AurelCore.gammadown3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.gammadown3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gammadown3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maths</span><span class="o">.</span><span class="n">format_rank2_3</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gxx&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gxy&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gxz&quot;</span><span class="p">],</span>
             <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gyy&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gyz&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gzz&quot;</span><span class="p">]])</span></div>


<div class="viewcode-block" id="AurelCore.gammaup3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.gammaup3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gammaup3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maths</span><span class="o">.</span><span class="n">inverse3</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.dtgammaup3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.dtgammaup3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dtgammaup3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Lie_beta</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="s1">&#39;s_uu&#39;</span><span class="p">)</span> 
                <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kup3&quot;</span><span class="p">])</span></div>


<div class="viewcode-block" id="AurelCore.gammadet">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.gammadet">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gammadet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maths</span><span class="o">.</span><span class="n">determinant3</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.gammadown4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.gammadown4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gammadown4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[[</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betamag&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betadown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> 
                  <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betadown3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betadown3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]],</span> 
                 <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betadown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> 
                  <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span> 
                 <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betadown3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> 
                  <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span> 
                 <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betadown3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> 
                  <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]]])</span></div>

    
<div class="viewcode-block" id="AurelCore.gammaup4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.gammaup4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gammaup4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[[</span><span class="n">zero</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">zero</span><span class="p">],</span> 
                 <span class="p">[</span><span class="n">zero</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> 
                  <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span> 
                 <span class="p">[</span><span class="n">zero</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> 
                  <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span> 
                 <span class="p">[</span><span class="n">zero</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> 
                  <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]]])</span></div>

    
<div class="viewcode-block" id="AurelCore.psi_bssnok">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.psi_bssnok">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">psi_bssnok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadet&quot;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.phi_bssnok">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.phi_bssnok">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">phi_bssnok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;psi_bssnok&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.dtphi_bssnok">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.dtphi_bssnok">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dtphi_bssnok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Lie_beta</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;phi_bssnok&quot;</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>
                <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Ktrace&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.gammaup3_bssnok">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.gammaup3_bssnok">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gammaup3_bssnok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;psi_bssnok&quot;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="AurelCore.gammadown3_bssnok">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.gammadown3_bssnok">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gammadown3_bssnok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;psi_bssnok&quot;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="AurelCore.dtgammadown3_bssnok">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.dtgammadown3_bssnok">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dtgammadown3_bssnok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Lie_beta</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3_bssnok&quot;</span><span class="p">],</span> <span class="s1">&#39;s_dd&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=-</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> 
                <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Adown3_bssnok&quot;</span><span class="p">])</span></div>

    
    <span class="c1"># Extrinsic curvature</span>
<div class="viewcode-block" id="AurelCore.kxx">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.kxx">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">kxx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;Kdown3&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.kxy">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.kxy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">kxy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;Kdown3&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.kxz">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.kxz">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">kxz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;Kdown3&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.kyy">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.kyy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">kyy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;Kdown3&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.kyz">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.kyz">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">kyz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;Kdown3&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.kzz">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.kzz">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">kzz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;Kdown3&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.Kdown3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Kdown3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Kdown3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maths</span><span class="o">.</span><span class="n">format_rank2_3</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;kxx&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;kxy&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;kxz&quot;</span><span class="p">],</span>
             <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;kyy&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;kyz&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;kzz&quot;</span><span class="p">]])</span></div>

    
<div class="viewcode-block" id="AurelCore.Kup3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Kup3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Kup3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;ia..., jb..., ij... -&gt; ab...&#39;</span><span class="p">,</span> 
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span>  <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.Ktrace">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Ktrace">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Ktrace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace3</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.dtKtrace">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.dtKtrace">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dtKtrace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dtK</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Lie_beta</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Ktrace&quot;</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., ij... -&gt; ...&#39;</span><span class="p">,</span> 
                         <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;DDalpha&quot;</span><span class="p">])</span>
            <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;A2_bssnok&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Ktrace&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vacuum</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s1">&#39;Using vacuum shortcut for dtKtrace&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">dtK</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dtK</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;rho_n&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Stresstrace_n&quot;</span><span class="p">]</span> 
                <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Lambda</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span><span class="p">))</span></div>

    
<div class="viewcode-block" id="AurelCore.Adown3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Adown3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Adown3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracefree3</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.Aup3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Aup3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Aup3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ia..., jb..., ab... -&gt; ij...&#39;</span><span class="p">,</span>
                         <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Adown3&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.A2">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.A2">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">A2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">magnitude3</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Adown3&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.Adown3_bssnok">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Adown3_bssnok">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Adown3_bssnok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;psi_bssnok&quot;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Adown3&quot;</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="AurelCore.dtAdown3_bssnok">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.dtAdown3_bssnok">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dtAdown3_bssnok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Eq 11.38 Baumgarte &amp; Shapiro</span>
        <span class="n">Ricci</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Ricci_down3_bssnok&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Ricci_down3_phi&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vacuum</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s1">&#39;Using vacuum shortcut for dtAdown3_bssnok&#39;</span><span class="p">)</span>
            <span class="n">innerterm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracefree3</span><span class="p">(</span>
                <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;DDalpha&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">Ricci</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">innerterm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracefree3</span><span class="p">(</span>
                <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;DDalpha&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">Ricci</span>
                <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Stressdown3_n&quot;</span><span class="p">])</span>
        <span class="n">AAterm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;ia..., bj..., ab... -&gt; ij...&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Adown3_bssnok&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Adown3_bssnok&quot;</span><span class="p">],</span> 
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3_bssnok&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Lie_beta</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Adown3_bssnok&quot;</span><span class="p">],</span> <span class="s1">&#39;s_dd&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=-</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;phi_bssnok&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">innerterm</span>
                <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Ktrace&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Adown3_bssnok&quot;</span><span class="p">]</span>
                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">AAterm</span><span class="p">))</span></div>

    
<div class="viewcode-block" id="AurelCore.Aup3_bssnok">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Aup3_bssnok">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Aup3_bssnok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;psi_bssnok&quot;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Aup3&quot;</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="AurelCore.A2_bssnok">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.A2_bssnok">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">A2_bssnok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., ij... -&gt; ...&#39;</span><span class="p">,</span> 
                          <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Adown3_bssnok&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Aup3_bssnok&quot;</span><span class="p">])</span></div>

    
    <span class="c1"># Lapse</span>
<div class="viewcode-block" id="AurelCore.alpha">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.alpha">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.dtalpha">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.dtalpha">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dtalpha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.DDalpha">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.DDalpha">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">DDalpha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_covd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s_covd</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span></div>

    
    <span class="c1"># Shift</span>
<div class="viewcode-block" id="AurelCore.betax">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.betax">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">betax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;betaup3&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.betay">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.betay">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">betay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;betaup3&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.betaz">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.betaz">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">betaz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;betaup3&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>


<div class="viewcode-block" id="AurelCore.betaup3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.betaup3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">betaup3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betax&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betay&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaz&quot;</span><span class="p">]])</span></div>

        
<div class="viewcode-block" id="AurelCore.dtbetax">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.dtbetax">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dtbetax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;dtbetaup3&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;dtbetaup3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.dtbetay">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.dtbetay">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dtbetay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;dtbetaup3&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;dtbetaup3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.dtbetaz">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.dtbetaz">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dtbetaz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;dtbetaup3&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;dtbetaup3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.dtbetaup3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.dtbetaup3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dtbetaup3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;dtbetax&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;dtbetay&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;dtbetaz&quot;</span><span class="p">]])</span></div>

    
<div class="viewcode-block" id="AurelCore.betadown3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.betadown3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">betadown3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
                <span class="s1">&#39;i..., ij... -&gt; j...&#39;</span><span class="p">,</span>
                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">])</span></div>

        
<div class="viewcode-block" id="AurelCore.betamag">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.betamag">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">betamag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
                <span class="s1">&#39;i..., i... -&gt; ...&#39;</span><span class="p">,</span>
                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betadown3&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.dttau">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.dttau">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dttau</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betamag&quot;</span><span class="p">]))</span></div>

    
    <span class="c1"># Timelike normal vector</span>
<div class="viewcode-block" id="AurelCore.nup4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.nup4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">nup4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">),</span> 
             <span class="o">-</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
             <span class="o">-</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> 
             <span class="o">-</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]),</span>
             <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">])</span></div>


<div class="viewcode-block" id="AurelCore.ndown4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.ndown4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">ndown4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">],</span> 
                 <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">),</span>
                 <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">),</span>
                 <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)])</span></div>

    
    <span class="c1"># Spacetime metric</span>
<div class="viewcode-block" id="AurelCore.gdown4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.gdown4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gdown4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[[</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gtt&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betadown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> 
                  <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betadown3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betadown3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]],</span>
                 <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betadown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> 
                  <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span>
                 <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betadown3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> 
                  <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span>
                 <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betadown3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> 
                  <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]]])</span></div>

    
<div class="viewcode-block" id="AurelCore.gup4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.gup4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gup4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maths</span><span class="o">.</span><span class="n">inverse4</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">])</span></div>


<div class="viewcode-block" id="AurelCore.gdet">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.gdet">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gdet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;gdown4&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">maths</span><span class="o">.</span><span class="n">determinant4</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadet&quot;</span><span class="p">]</span></div>

    
    <span class="c1"># Null ray expansion</span>
<div class="viewcode-block" id="AurelCore.null_ray_exp_out">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.null_ray_exp_out">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">null_ray_exp_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Center of extraction sphere set to&quot;</span>
                     <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; AurelCore.center = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">cartesian_to_spherical</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">null_ray_expansion</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">)</span></div>

    
    <span class="c1"># Null ray expansion</span>
<div class="viewcode-block" id="AurelCore.null_ray_exp_in">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.null_ray_exp_in">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">null_ray_exp_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Center of extraction sphere set to&quot;</span>
                     <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; AurelCore.center = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">cartesian_to_spherical</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">null_ray_expansion</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">)</span></div>

    
    <span class="c1"># === Matter quantities</span>
    <span class="c1"># Eulerian observer follows n^mu</span>
    <span class="c1"># Lagrangian observer follows u^mu</span>

<div class="viewcode-block" id="AurelCore.rho0">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.rho0">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">rho0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;rho&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;eps&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.press">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.press">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">press</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.eps">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.eps">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">eps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;rho&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;rho0&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rho0&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.rho">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.rho">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">rho</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;rho0&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;eps&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.enthalpy">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.enthalpy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">enthalpy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;eps&quot;</span><span class="p">]</span> 
            <span class="o">+</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;press&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;rho0&quot;</span><span class="p">]))</span></div>

    
    <span class="c1"># Fluid velocity</span>
<div class="viewcode-block" id="AurelCore.w_lorentz">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.w_lorentz">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">w_lorentz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.velx">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.velx">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">velx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.vely">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.vely">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">vely</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.velz">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.velz">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">velz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.velup3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.velup3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">velup3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;velx&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;vely&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;velz&quot;</span><span class="p">]])</span></div>

    
<div class="viewcode-block" id="AurelCore.velup4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.velup4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">velup4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">),</span> 
                          <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;velx&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;vely&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;velz&quot;</span><span class="p">]])</span></div>

    
<div class="viewcode-block" id="AurelCore.veldown3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.veldown3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">veldown3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;veldown4&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span></div>

    
<div class="viewcode-block" id="AurelCore.veldown4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.veldown4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">veldown4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;i..., ij... -&gt; j...&#39;</span><span class="p">,</span> 
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;velup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.uup0">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.uup0">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">uup0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;w_lorentz&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.uup3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.uup3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">uup3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;w_lorentz&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;velup3&quot;</span><span class="p">]</span> 
            <span class="o">-</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]))</span></div>

    
<div class="viewcode-block" id="AurelCore.uup4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.uup4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">uup4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;uup0&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;uup3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;uup3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;uup3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]])</span></div>

    
<div class="viewcode-block" id="AurelCore.udown4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.udown4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">udown4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ab..., b... -&gt; a...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;uup4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.udown3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.udown3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">udown3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;udown4&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span></div>

    
<div class="viewcode-block" id="AurelCore.hdown4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.hdown4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">hdown4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;a..., b... -&gt; ab...&#39;</span><span class="p">,</span> 
                                          <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;udown4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;udown4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.hdet">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.hdet">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">hdet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maths</span><span class="o">.</span><span class="n">determinant3</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;hdown4&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">:])</span></div>

    
<div class="viewcode-block" id="AurelCore.hmixed4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.hmixed4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">hmixed4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ac..., cb... -&gt; ab...&#39;</span><span class="p">,</span> 
                         <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;hdown4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.hup4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.hup4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">hup4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gup4&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;a..., b... -&gt; ab...&#39;</span><span class="p">,</span> 
                                        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;uup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;uup4&quot;</span><span class="p">])</span></div>

    
    <span class="c1"># Energy-stress tensor</span>
<div class="viewcode-block" id="AurelCore.Tdown4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Tdown4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Tdown4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;rho&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;a..., b... -&gt; ab...&#39;</span><span class="p">,</span> 
                                        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;uup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;uup4&quot;</span><span class="p">])</span>
                <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;press&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;hdown4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.Tup4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Tup4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Tup4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ac..., bd..., ab... -&gt; cd...&#39;</span><span class="p">,</span> 
                          <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Tdown4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.Ttrace">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Ttrace">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Ttrace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;Tdown4&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;press_n&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;rho_n&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace4</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Tdown4&quot;</span><span class="p">])</span></div>

    
    <span class="c1"># Fluid quantities in Eulerian frame</span>
<div class="viewcode-block" id="AurelCore.rho_n">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.rho_n">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">rho_n</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ab..., a..., b... -&gt; ...&#39;</span><span class="p">,</span>
                         <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Tdown4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;nup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;nup4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.fluxup3_n">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.fluxup3_n">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fluxup3_n</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;ab..., bc..., c... -&gt; a...&#39;</span><span class="p">,</span> 
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Tdown4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;nup4&quot;</span><span class="p">])[</span><span class="mi">1</span><span class="p">:]</span></div>

    
<div class="viewcode-block" id="AurelCore.fluxdown3_n">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.fluxdown3_n">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fluxdown3_n</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;a..., ab... -&gt; b...&#39;</span><span class="p">,</span> 
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;fluxup3_n&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.angmomup3_n">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.angmomup3_n">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">angmomup3_n</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;ij..., j... -&gt; i...&#39;</span><span class="p">,</span> 
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;angmomdown3_n&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.angmomdown3_n">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.angmomdown3_n">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">angmomdown3_n</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;ijk..., j..., k... -&gt; i...&#39;</span><span class="p">,</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">levicivita_down3</span><span class="p">(),</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">cartesian_coords</span><span class="p">,</span> 
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;fluxup3_n&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.Stressup3_n">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Stressup3_n">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Stressup3_n</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;ac..., bd..., ab... -&gt; cd...&#39;</span><span class="p">,</span> 
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Tdown4&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">:])</span></div>

    
<div class="viewcode-block" id="AurelCore.Stressdown3_n">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Stressdown3_n">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Stressdown3_n</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;ac..., bd..., ab... -&gt; cd...&#39;</span><span class="p">,</span> 
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Stressup3_n&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.Stresstrace_n">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Stresstrace_n">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Stresstrace_n</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace3</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Tdown4&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">:])</span></div>

    
<div class="viewcode-block" id="AurelCore.press_n">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.press_n">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">press_n</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ab..., ab... -&gt; ...&#39;</span><span class="p">,</span> 
                        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Tdown4&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">3</span></div>

    
<div class="viewcode-block" id="AurelCore.anisotropic_press_down3_n">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.anisotropic_press_down3_n">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">anisotropic_press_down3_n</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Stressdown3_n&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;press_n&quot;</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="AurelCore.rho_n_fromHam">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.rho_n_fromHam">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">rho_n_fromHam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_RicciS&quot;</span><span class="p">]</span> 
                <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Ktrace&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> 
                <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., ij... -&gt; ...&#39;</span><span class="p">,</span> 
                            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kup3&quot;</span><span class="p">])</span>
                <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lambda</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.fluxup3_n_fromMom">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.fluxup3_n_fromMom">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fluxup3_n_fromMom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">CovD_term</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_covd</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kup3&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Ktrace&quot;</span><span class="p">],</span> <span class="s1">&#39;uu&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;bab... -&gt; a...&#39;</span><span class="p">,</span> <span class="n">CovD_term</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span></div>

    
    <span class="c1"># Conserved quantities</span>
<div class="viewcode-block" id="AurelCore.conserved_D">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.conserved_D">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">conserved_D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;rho0&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;w_lorentz&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadet&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.conserved_E">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.conserved_E">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">conserved_E</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_D&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;eps&quot;</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="AurelCore.conserved_Sdown4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.conserved_Sdown4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">conserved_Sdown4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_D&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;enthalpy&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;udown4&quot;</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="AurelCore.conserved_Sdown3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.conserved_Sdown3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">conserved_Sdown3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_Sdown4&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span></div>

    
<div class="viewcode-block" id="AurelCore.conserved_Sup4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.conserved_Sup4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">conserved_Sup4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;im...,m...-&gt;i...&#39;</span><span class="p">,</span> 
                         <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_Sdown4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.conserved_Sup3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.conserved_Sup3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">conserved_Sup3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_Sup4&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span></div>


<div class="viewcode-block" id="AurelCore.dtconserved">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.dtconserved">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dtconserved</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s1">&#39;WARNING: dtconserved only works for constant press/rho&#39;</span><span class="p">)</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;uup4&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;uup4&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">sgdet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadet&quot;</span><span class="p">])</span> 

        <span class="n">divD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ii...-&gt;...&#39;</span><span class="p">,</span> 
                         <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_rank1tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_D&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">V</span><span class="p">))</span>
        <span class="n">divE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ii... -&gt; ...&#39;</span><span class="p">,</span> 
                         <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_rank1tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_E&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">V</span><span class="p">))</span>
        <span class="n">divW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ii... -&gt; ...&#39;</span><span class="p">,</span> 
                         <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_rank1tensor</span><span class="p">(</span><span class="n">sgdet</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;w_lorentz&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">V</span><span class="p">))</span>
        <span class="n">divSdown3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
                    <span class="s1">&#39;jij...-&gt;i...&#39;</span><span class="p">,</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_rank2tensor</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i...,j...-&gt;ij...&#39;</span><span class="p">,</span> 
                                  <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_Sdown3&quot;</span><span class="p">],</span> <span class="n">V</span><span class="p">)))</span>

        <span class="n">dtD</span> <span class="o">=</span> <span class="o">-</span> <span class="n">divD</span>
        <span class="n">SSdg</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_Sdown4&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
                 <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_Sdown4&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
                 <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
                <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_Sdown4&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
                   <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;j..., ij... -&gt; i...&#39;</span><span class="p">,</span> 
                               <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_Sup3&quot;</span><span class="p">],</span> 
                               <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_rank1tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betadown3&quot;</span><span class="p">])))</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;j..., k..., ijk... -&gt; i...&#39;</span><span class="p">,</span> 
                             <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_Sup3&quot;</span><span class="p">],</span>
                             <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_Sup3&quot;</span><span class="p">],</span> 
                             <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_rank2tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">]))))</span>
        <span class="n">dtSdown3</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span> <span class="n">divSdown3</span> 
               <span class="o">+</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span> <span class="n">SSdg</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_Sdown4&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
               <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">sgdet</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;press&quot;</span><span class="p">]))</span>
        <span class="c1"># dtw_lorentz</span>
        <span class="n">CovDbeta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_covd</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">],</span> <span class="s1">&#39;u&#39;</span><span class="p">)</span>
        <span class="n">dtsgdet</span> <span class="o">=</span> <span class="n">sgdet</span> <span class="o">*</span> <span class="p">(</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Ktrace&quot;</span><span class="p">]</span>
                            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ii... -&gt; ...&#39;</span><span class="p">,</span> <span class="n">CovDbeta</span><span class="p">))</span>
        <span class="n">W2m1</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;w_lorentz&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">W2m1oDpE</span> <span class="o">=</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span>
            <span class="n">W2m1</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_D&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_E&quot;</span><span class="p">]))</span>
        <span class="n">fac1</span> <span class="o">=</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span>
            <span class="n">W2m1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;w_lorentz&quot;</span><span class="p">]</span> 
            <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., i..., j... -&gt; ...&#39;</span><span class="p">,</span> 
                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> 
                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_Sdown3&quot;</span><span class="p">],</span> 
                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_Sdown3&quot;</span><span class="p">]))</span>
        <span class="n">par1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., i..., j... -&gt; ...&#39;</span><span class="p">,</span>
                          <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;dtgammaup3&quot;</span><span class="p">],</span> 
                          <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_Sdown3&quot;</span><span class="p">],</span> 
                          <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_Sdown3&quot;</span><span class="p">])</span>
                <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., i..., j... -&gt; ...&#39;</span><span class="p">,</span>
                                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> 
                                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_Sdown3&quot;</span><span class="p">],</span> 
                                <span class="n">dtSdown3</span><span class="p">))</span>
        <span class="n">fac2</span> <span class="o">=</span> <span class="o">-</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span><span class="n">W2m1oDpE</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;w_lorentz&quot;</span><span class="p">])</span>
        <span class="n">par2</span> <span class="o">=</span> <span class="p">(</span><span class="n">dtD</span>
                 <span class="o">-</span> <span class="n">divE</span>
                 <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;press&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">divW</span><span class="p">)</span>
        <span class="n">fac3</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;press&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">W2m1oDpE</span> <span class="o">*</span> <span class="n">dtsgdet</span>
        <span class="n">dtW</span> <span class="o">=</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span>
            <span class="p">(</span><span class="n">fac1</span> <span class="o">*</span> <span class="n">par1</span> <span class="o">+</span> <span class="n">fac2</span> <span class="o">*</span> <span class="n">par2</span> <span class="o">+</span> <span class="n">fac3</span><span class="p">),</span>
            <span class="p">(</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;press&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">sgdet</span> <span class="o">*</span> <span class="n">W2m1oDpE</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;w_lorentz&quot;</span><span class="p">]</span> <span class="p">)))</span>
        <span class="n">dtsgdetW</span> <span class="o">=</span> <span class="n">dtsgdet</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;w_lorentz&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">sgdet</span> <span class="o">*</span> <span class="n">dtW</span>
        <span class="n">dtE</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span> <span class="n">divE</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;press&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">dtsgdetW</span> <span class="o">+</span> <span class="n">divW</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">dtD</span><span class="p">,</span> <span class="n">dtE</span><span class="p">,</span> <span class="n">dtSdown3</span></div>

    
    <span class="c1"># Kinematics</span>
<div class="viewcode-block" id="AurelCore.st_covd_udown4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.st_covd_udown4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">st_covd_udown4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dtD</span><span class="p">,</span> <span class="n">dtE</span><span class="p">,</span> <span class="n">dtSdown3</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;dtconserved&quot;</span><span class="p">]</span>
    
        <span class="c1"># dtu</span>
        <span class="n">dtudown3</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;udown3&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span><span class="n">dtSdown3</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_Sdown3&quot;</span><span class="p">])</span>
            <span class="o">-</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span><span class="n">dtD</span> <span class="o">+</span> <span class="n">dtE</span><span class="p">,</span> 
                                  <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_D&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;conserved_E&quot;</span><span class="p">]))</span>
        <span class="n">dtudown0</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span>
                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij...,i...,j...-&gt;...&#39;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;dtgammaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;udown3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;udown3&quot;</span><span class="p">])</span>
                <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i...,i...-&gt;...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;uup3&quot;</span><span class="p">],</span> <span class="n">dtudown3</span><span class="p">)),</span>
                <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;w_lorentz&quot;</span><span class="p">]))</span> 
            <span class="o">-</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;uup0&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;dtalpha&quot;</span><span class="p">],</span> 
                                  <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]))</span>
        <span class="n">dtudown4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">dtudown0</span><span class="p">,</span> 
                     <span class="n">dtudown3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtudown3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtudown3</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
        <span class="c1"># spacetime covariant derivative</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">st_covd</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;udown4&quot;</span><span class="p">],</span> <span class="n">dtudown4</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.accelerationdown4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.accelerationdown4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">accelerationdown4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;a..., ab... -&gt; b...&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;uup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_covd_udown4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.accelerationup4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.accelerationup4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">accelerationup4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;ab..., b... -&gt; a...&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;accelerationdown4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.s_covd_udown4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.s_covd_udown4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">s_covd_udown4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;ab...,ac...-&gt;bc...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;hmixed4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_covd_udown4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.thetadown4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.thetadown4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">thetadown4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maths</span><span class="o">.</span><span class="n">symmetrise_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_covd_udown4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.theta">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.theta">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">theta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ab..., ab... -&gt; ...&#39;</span><span class="p">,</span> 
                         <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;hup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;thetadown4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.sheardown4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.sheardown4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">sheardown4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;thetadown4&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;hdown4&quot;</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="AurelCore.shear2">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.shear2">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">shear2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;ai..., bj..., ab..., ij... -&gt; ...&#39;</span><span class="p">,</span> 
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;hup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;hup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;sheardown4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;sheardown4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.omegadown4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.omegadown4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">omegadown4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maths</span><span class="o">.</span><span class="n">antisymmetrise_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_covd_udown4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.omega2">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.omega2">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">omega2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;ai..., bj..., ab..., ij... -&gt; ...&#39;</span><span class="p">,</span> 
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;hup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;hup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;omegadown4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;omegadown4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.s_RicciS_u">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.s_RicciS_u">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">s_RicciS_u</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;shear2&quot;</span><span class="p">]</span>
            <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lambda</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;rho&quot;</span><span class="p">]</span>
        <span class="p">)</span></div>


    <span class="c1"># === Curvature quantities</span>
    <span class="c1"># of spatial metric</span>
<div class="viewcode-block" id="AurelCore.s_Gamma_udd3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.s_Gamma_udd3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">s_Gamma_udd3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># First the spatial derivatives of the metric derivative are computed.</span>
        <span class="n">dgammaxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> 
        <span class="c1">#        = [dxgxx, dygxx, dzgxx]</span>
        <span class="n">dgammaxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">dgammaxz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">dgammayy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">dgammayz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">dgammazz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
            
        <span class="c1"># Spatial Christoffel symbols with all indices down: Gamma_{jkl}.</span>
        <span class="n">Gxyz</span> <span class="o">=</span> <span class="n">dgammaxz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dgammaxy</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">dgammayz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Gx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="n">dgammaxx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dgammaxx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dgammaxx</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
             <span class="p">[</span><span class="n">dgammaxx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="o">*</span><span class="n">dgammaxy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">dgammayy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Gxyz</span><span class="p">],</span>
             <span class="p">[</span><span class="n">dgammaxx</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Gxyz</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">dgammaxz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">dgammazz</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])</span>
            
        <span class="n">Gyxz</span> <span class="o">=</span> <span class="n">dgammayz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dgammaxy</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">dgammaxz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">Gy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="mi">2</span><span class="o">*</span><span class="n">dgammaxy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">dgammaxx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dgammayy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Gyxz</span><span class="p">],</span>
             <span class="p">[</span><span class="n">dgammayy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dgammayy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dgammayy</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
             <span class="p">[</span><span class="n">Gyxz</span><span class="p">,</span> <span class="n">dgammayy</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="o">*</span><span class="n">dgammayz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">dgammazz</span><span class="p">[</span><span class="mi">1</span><span class="p">]]])</span>
            
        <span class="n">Gzxy</span> <span class="o">=</span> <span class="n">dgammayz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dgammaxz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">dgammaxy</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">Gz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="mi">2</span><span class="o">*</span><span class="n">dgammaxz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">dgammaxx</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Gzxy</span><span class="p">,</span> <span class="n">dgammazz</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
             <span class="p">[</span><span class="n">Gzxy</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">dgammayz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">dgammayy</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">dgammazz</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
             <span class="p">[</span><span class="n">dgammazz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dgammazz</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dgammazz</span><span class="p">[</span><span class="mi">2</span><span class="p">]]])</span>
        <span class="n">Gddd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Gx</span><span class="p">,</span><span class="n">Gy</span><span class="p">,</span><span class="n">Gz</span><span class="p">])</span>
            
        <span class="c1"># Spatial Christoffel symbols with indices: Gamma^{i}_{kl}.</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., jkl... -&gt; ikl...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="n">Gddd</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.s_Riemann_uddd3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.s_Riemann_uddd3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">s_Riemann_uddd3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dGudd3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3x_rank2tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> 
             <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3y_rank2tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> 
             <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3z_rank2tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> 
             <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]])</span>
        <span class="n">Rterm0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;cabd... -&gt; abcd...&#39;</span><span class="p">,</span> <span class="n">dGudd3</span><span class="p">)</span>
        <span class="n">Rterm1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;dabc... -&gt; abcd...&#39;</span><span class="p">,</span> <span class="n">dGudd3</span><span class="p">)</span>
        <span class="n">Rterm2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;apc..., pbd... -&gt; abcd...&#39;</span><span class="p">,</span> 
                        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">])</span>
        <span class="n">Rterm3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;apd..., pbc... -&gt; abcd...&#39;</span><span class="p">,</span> 
                            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">Rterm0</span> <span class="o">-</span> <span class="n">Rterm1</span> <span class="o">+</span> <span class="n">Rterm2</span> <span class="o">-</span> <span class="n">Rterm3</span></div>

    
<div class="viewcode-block" id="AurelCore.s_Riemann_down3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.s_Riemann_down3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">s_Riemann_down3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;abcd..., ai... -&gt; ibcd...&#39;</span><span class="p">,</span> 
                         <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Riemann_uddd3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.s_Ricci_down3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.s_Ricci_down3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">s_Ricci_down3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;s_Riemann_down3&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;abcd..., ac... -&gt; bd...&#39;</span><span class="p">,</span> 
                             <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Riemann_down3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dGudd3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3x_rank2tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> 
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)],</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3y_rank2tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> 
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)],</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3z_rank2tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> 
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]])</span>
            <span class="n">Rterm0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;aabd... -&gt; bd...&#39;</span><span class="p">,</span> <span class="n">dGudd3</span><span class="p">)</span>
            <span class="n">Rterm1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;daba... -&gt; bd...&#39;</span><span class="p">,</span> <span class="n">dGudd3</span><span class="p">)</span>
            <span class="n">Rterm2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;apa..., pbd... -&gt; bd...&#39;</span><span class="p">,</span> 
                            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">])</span>
            <span class="n">Rterm3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;apd..., pba... -&gt; bd...&#39;</span><span class="p">,</span> 
                                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">Rterm0</span> <span class="o">-</span> <span class="n">Rterm1</span> <span class="o">+</span> <span class="n">Rterm2</span> <span class="o">-</span> <span class="n">Rterm3</span></div>


<div class="viewcode-block" id="AurelCore.s_RicciS">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.s_RicciS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">s_RicciS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace3</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Ricci_down3&quot;</span><span class="p">])</span></div>

        
    <span class="c1"># of spacetime metric</span>
<div class="viewcode-block" id="AurelCore.st_Gamma_udd4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.st_Gamma_udd4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">st_Gamma_udd4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Repeated calculations</span>
        <span class="n">dalpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">])</span>
        <span class="n">betadalpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;m..., m... -&gt; ...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">],</span> <span class="n">dalpha</span><span class="p">)</span>
        <span class="n">betaK</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;m..., mn... -&gt; n...&#39;</span><span class="p">,</span> 
                          <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">])</span>
        <span class="n">betabetaK</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;m..., n... -&gt; ...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">],</span> <span class="n">betaK</span><span class="p">)</span>
        <span class="n">dbeta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_covd</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">],</span> <span class="s1">&#39;u&#39;</span><span class="p">)</span>

        <span class="c1"># time part of index up</span>
        <span class="n">Gttt</span> <span class="o">=</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;dtalpha&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">betadalpha</span> <span class="o">-</span> <span class="n">betabetaK</span><span class="p">,</span> 
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">])</span>
        <span class="n">Gtti</span> <span class="o">=</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span><span class="n">dalpha</span> <span class="o">-</span> <span class="n">betaK</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">])</span>
        <span class="n">Gtij</span> <span class="o">=</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span><span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">])</span>
        <span class="n">Gt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="n">Gttt</span><span class="p">,</span> <span class="n">Gtti</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Gtti</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Gtti</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
            <span class="p">[</span><span class="n">Gtti</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Gtij</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">Gtij</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">Gtij</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span>
            <span class="p">[</span><span class="n">Gtti</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Gtij</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">Gtij</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">Gtij</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span>
            <span class="p">[</span><span class="n">Gtti</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Gtij</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">Gtij</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">Gtij</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]]])</span>

        <span class="c1"># space part of index up</span>
        <span class="n">Gltt</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;lm..., m... -&gt; l...&#39;</span><span class="p">,</span> 
                    <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> 
                    <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">dalpha</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">betaK</span><span class="p">)</span>
            <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">Gttt</span> 
            <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;dtbetaup3&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;m..., ml...-&gt; l...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">],</span> <span class="n">dbeta</span><span class="p">))</span>
        <span class="n">Glmt</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;l..., m...-&gt; lm...&#39;</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">],</span> <span class="n">Gtti</span><span class="p">)</span>
            <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ln..., nm... -&gt; lm...&#39;</span><span class="p">,</span> 
                                    <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> 
                                    <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">])</span>
            <span class="o">+</span> <span class="n">dbeta</span><span class="p">)</span>
        <span class="n">Glij</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">]</span> 
            <span class="o">+</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
                    <span class="s1">&#39;l..., ij... -&gt; lij...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">]),</span> 
                    <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]))</span>
        <span class="n">Gl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="n">Gltt</span><span class="p">,</span> <span class="n">Glmt</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">Glmt</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">Glmt</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]],</span> 
            <span class="p">[</span><span class="n">Glmt</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">Glij</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">Glij</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">Glij</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span>
            <span class="p">[</span><span class="n">Glmt</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">Glij</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">Glij</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">Glij</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]],</span>
            <span class="p">[</span><span class="n">Glmt</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">Glij</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">Glij</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">Glij</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Gt</span><span class="p">,</span> <span class="n">Gl</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">Gl</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">Gl</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]])</span></div>

    
<div class="viewcode-block" id="AurelCore.st_Riemann_uddd4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.st_Riemann_uddd4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">st_Riemann_uddd4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;abcd..., ai... -&gt; ibcd...&#39;</span><span class="p">,</span>
                         <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Riemann_down4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gup4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.st_Riemann_down4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.st_Riemann_down4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">st_Riemann_down4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Riemann_ssss : Gauss equation, eq 2.38 in Shibata</span>
        <span class="n">Riemann_ssss</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Riemann_down3&quot;</span><span class="p">]</span>
                        <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ac..., bd... -&gt; abcd...&#39;</span><span class="p">,</span> 
                                    <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">])</span>
                        <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ad..., bc... -&gt; abcd...&#39;</span><span class="p">,</span> 
                                    <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">]))</span>
        
        <span class="c1"># Riemann_ssst : Codazzi equation, eq 2.41 in Shibata</span>
        <span class="n">dKdown</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_covd</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">],</span> <span class="s1">&#39;dd&#39;</span><span class="p">)</span>
        <span class="n">Riemann_ssst</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijkl..., l... -&gt; ijk...&#39;</span><span class="p">,</span> 
                       <span class="n">Riemann_ssss</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">])</span>
            <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;jik... -&gt; ijk...&#39;</span><span class="p">,</span> <span class="n">dKdown</span><span class="p">)</span> 
                <span class="o">-</span> <span class="n">dKdown</span><span class="p">))</span>
            
        <span class="c1"># Riemann_stst: the Mainardi equation, eq 2.56 in Shibata</span>
        <span class="n">Kdown4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_to_st</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">])</span>
        <span class="n">Riemann_stst</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;jki..., k... -&gt; ij...&#39;</span><span class="p">,</span> <span class="n">Riemann_ssst</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">])</span>
            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ikj..., k... -&gt; ij...&#39;</span><span class="p">,</span> 
                         <span class="n">Riemann_ssst</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">])</span>
            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ikjl..., k..., l... -&gt; ij...&#39;</span><span class="p">,</span> 
                        <span class="n">Riemann_ssss</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Ricci_down3&quot;</span><span class="p">]</span>
            <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ib..., ja..., ab... -&gt; ij...&#39;</span><span class="p">,</span> 
                        <span class="n">Kdown4</span><span class="p">,</span> <span class="n">Kdown4</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gup4&quot;</span><span class="p">])[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">:]</span>
            <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Ktrace&quot;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vacuum</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s1">&#39;Using vacuum shortcut for st_Riemann_down4&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Riemann_stst</span> <span class="o">+=</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Ricci_down3&quot;</span><span class="p">]</span>
            
        <span class="c1"># put it all together</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">maths</span><span class="o">.</span><span class="n">populate_4Riemann</span><span class="p">(</span>
            <span class="n">Riemann_ssss</span><span class="p">,</span> <span class="n">Riemann_ssst</span><span class="p">,</span> <span class="n">Riemann_stst</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">R</span></div>

    
<div class="viewcode-block" id="AurelCore.st_Riemann_uudd4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.st_Riemann_uudd4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">st_Riemann_uudd4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;abcd..., ae..., bf... -&gt; efcd...&#39;</span><span class="p">,</span> 
                         <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Riemann_down4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gup4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.st_Ricci_down4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.st_Ricci_down4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">st_Ricci_down4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;Tdown4&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Lambda</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span> <span class="o">*</span> <span class="p">(</span>
               <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Tdown4&quot;</span><span class="p">]</span>
                <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Ttrace&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;abad... -&gt; bd...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Riemann_uddd4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.st_Ricci_down3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.st_Ricci_down3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">st_Ricci_down3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;st_Ricci_down4&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Ricci_down4&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Lambda</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Tdown4&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace4</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Tdown4&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">]))</span></div>

    
<div class="viewcode-block" id="AurelCore.st_RicciS">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.st_RicciS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">st_RicciS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace4</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Ricci_down4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.Einsteindown4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Einsteindown4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Einsteindown4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Ricci_down4&quot;</span><span class="p">]</span> 
                <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_RicciS&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.Kretschmann">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Kretschmann">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Kretschmann</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;abcd..., cdab... -&gt; ...&#39;</span><span class="p">,</span> 
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Riemann_uudd4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Riemann_uudd4&quot;</span><span class="p">])</span></div>

    
    <span class="c1"># In BSSNOK form</span>
<div class="viewcode-block" id="AurelCore.s_Gamma_udd3_bssnok">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.s_Gamma_udd3_bssnok">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">s_Gamma_udd3_bssnok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Alcubierre 2.8.14</span>
        <span class="n">dphi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;phi_bssnok&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ki..., j... -&gt; kij...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kronecker_delta3</span><span class="p">(),</span> <span class="n">dphi</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;kj..., i... -&gt; kij...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kronecker_delta3</span><span class="p">(),</span> <span class="n">dphi</span><span class="p">)</span>
            <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., kl..., l... -&gt; kij...&#39;</span><span class="p">,</span> 
                        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="n">dphi</span><span class="p">))</span></div>

    
<div class="viewcode-block" id="AurelCore.s_Gamma_bssnok">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.s_Gamma_bssnok">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">s_Gamma_bssnok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;jij... -&gt; i...&#39;</span><span class="p">,</span> 
                           <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_rank2tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3_bssnok&quot;</span><span class="p">]))</span></div>

    
<div class="viewcode-block" id="AurelCore.dts_Gamma_bssnok">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.dts_Gamma_bssnok">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dts_Gamma_bssnok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Eq 2.8.25 of Alcubierre</span>
        <span class="n">ddbeta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_rank2tensor</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_rank1tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">]))</span>
        <span class="n">Gamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lie_beta</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_bssnok&quot;</span><span class="p">],</span> <span class="s1">&#39;s_u&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">Gamma</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;jk..., jki... -&gt; i...&#39;</span><span class="p">,</span> 
                          <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3_bssnok&quot;</span><span class="p">],</span> <span class="n">ddbeta</span><span class="p">)</span>
        <span class="n">Gamma</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., jkk... -&gt; i...&#39;</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3_bssnok&quot;</span><span class="p">],</span> <span class="n">ddbeta</span><span class="p">)</span>
        <span class="n">Gamma</span> <span class="o">+=</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., j... -&gt; i...&#39;</span><span class="p">,</span> 
                                 <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Aup3_bssnok&quot;</span><span class="p">],</span> 
                                 <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]))</span>
        <span class="n">Gamma</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijk..., jk... -&gt; i...&#39;</span><span class="p">,</span> 
                                               <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3_bssnok&quot;</span><span class="p">],</span> 
                                               <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Aup3_bssnok&quot;</span><span class="p">])</span>
        <span class="n">Gamma</span> <span class="o">+=</span> <span class="mi">12</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., j... -&gt; i...&#39;</span><span class="p">,</span> 
                                                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Aup3_bssnok&quot;</span><span class="p">],</span> 
                                                <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_scalar</span><span class="p">(</span>
                                                    <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;phi_bssnok&quot;</span><span class="p">]))</span>
        <span class="n">Gamma</span> <span class="o">+=</span> <span class="o">-</span> <span class="p">(</span><span class="mi">4</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., j... -&gt; i...&#39;</span><span class="p">,</span>
                                                    <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3_bssnok&quot;</span><span class="p">],</span> 
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_scalar</span><span class="p">(</span>
                                                        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Ktrace&quot;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vacuum</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s1">&#39;Using vacuum shortcut for dts_Gamma_bssnok&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Gamma</span> <span class="o">+=</span> <span class="p">(</span><span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> 
                    <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;phi_bssnok&quot;</span><span class="p">])</span> 
                    <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;fluxup3_n&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">Gamma</span></div>

    
<div class="viewcode-block" id="AurelCore.s_Ricci_down3_bssnok">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.s_Ricci_down3_bssnok">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">s_Ricci_down3_bssnok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Eq 2.8.18 of Alcubierre</span>
        <span class="n">Ricci</span> <span class="o">=</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;lm..., lmij... -&gt; ij...&#39;</span><span class="p">,</span> 
                                  <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3_bssnok&quot;</span><span class="p">],</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_rank3tensor</span><span class="p">(</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_rank2tensor</span><span class="p">(</span>
                                          <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3_bssnok&quot;</span><span class="p">])))</span>
        <span class="n">tosymmetrise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ki..., jk... -&gt; ij...&#39;</span><span class="p">,</span>
                           <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3_bssnok&quot;</span><span class="p">],</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_rank1tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_bssnok&quot;</span><span class="p">]))</span>
        <span class="n">Gddd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;oi..., ojk... -&gt; ijk...&#39;</span><span class="p">,</span> 
                         <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3_bssnok&quot;</span><span class="p">],</span>
                         <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3_bssnok&quot;</span><span class="p">])</span>
        <span class="n">tosymmetrise</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;k..., ijk... -&gt; ij...&#39;</span><span class="p">,</span>
                           <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_bssnok&quot;</span><span class="p">],</span>
                           <span class="n">Gddd</span><span class="p">)</span>
        <span class="n">tosymmetrise</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;lm..., kli..., jkm... -&gt; ij...&#39;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3_bssnok&quot;</span><span class="p">],</span>
                            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3_bssnok&quot;</span><span class="p">],</span>
                            <span class="n">Gddd</span><span class="p">)</span>
        <span class="n">Ricci</span> <span class="o">+=</span> <span class="n">maths</span><span class="o">.</span><span class="n">symmetrise_tensor</span><span class="p">(</span><span class="n">tosymmetrise</span><span class="p">)</span>
        <span class="n">Ricci</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;lm..., kim..., klj... -&gt; ij...&#39;</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3_bssnok&quot;</span><span class="p">],</span>
                                  <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3_bssnok&quot;</span><span class="p">],</span>
                                  <span class="n">Gddd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Ricci</span></div>

    
<div class="viewcode-block" id="AurelCore.s_RicciS_bssnok">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.s_RicciS_bssnok">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">s_RicciS_bssnok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., ij... -&gt; ...&#39;</span><span class="p">,</span> 
                         <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3_bssnok&quot;</span><span class="p">],</span> 
                         <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Ricci_down3_bssnok&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.s_Ricci_down3_phi">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.s_Ricci_down3_phi">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">s_Ricci_down3_phi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Alcubierre 2.8.18</span>
        <span class="n">dphi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;phi_bssnok&quot;</span><span class="p">])</span>
        <span class="n">ddphi</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_rank1tensor</span><span class="p">(</span><span class="n">dphi</span><span class="p">)</span> 
                 <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;kij..., k... -&gt; ij...&#39;</span><span class="p">,</span> 
                             <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3_bssnok&quot;</span><span class="p">],</span> <span class="n">dphi</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ddphi</span> 
            <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3_bssnok&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
                <span class="s1">&#39;ij..., ij... -&gt; ...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3_bssnok&quot;</span><span class="p">],</span> <span class="n">ddphi</span><span class="p">)</span>
            <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i..., j... -&gt; ij...&#39;</span><span class="p">,</span> <span class="n">dphi</span><span class="p">,</span> <span class="n">dphi</span><span class="p">)</span>
            <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3_bssnok&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
                <span class="s1">&#39;ij..., i..., j... -&gt; ...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3_bssnok&quot;</span><span class="p">],</span> <span class="n">dphi</span><span class="p">,</span> <span class="n">dphi</span><span class="p">)</span>
            <span class="p">)</span></div>

    
    <span class="c1"># Constraints</span>
<div class="viewcode-block" id="AurelCore.Hamiltonian">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Hamiltonian">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Hamiltonian</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Ham</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_RicciS&quot;</span><span class="p">]</span> 
                <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Ktrace&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> 
                <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., ij... -&gt; ...&#39;</span><span class="p">,</span> 
                            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kup3&quot;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vacuum</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s1">&#39;Using vacuum shortcut for Hamiltonian&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Ham</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">Ham</span>
                <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;rho_n&quot;</span><span class="p">]</span> 
                <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lambda</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.Hamiltonian_Escale">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Hamiltonian_Escale">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Hamiltonian_Escale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">HamE</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_RicciS&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> 
            <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Ktrace&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">4</span> 
            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., ij... -&gt; ...&#39;</span><span class="p">,</span> 
                        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kup3&quot;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vacuum</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s1">&#39;Using vacuum shortcut for Hamiltonian_Escale&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">HamE</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span>
                <span class="n">HamE</span> 
                <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;rho_n&quot;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> 
                <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lambda</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span></div>

    
<div class="viewcode-block" id="AurelCore.Hamiltonian_norm">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Hamiltonian_norm">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Hamiltonian_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Hamiltonian&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Hamiltonian_Escale&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.Momentumx">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Momentumx">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Momentumx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentumup3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="AurelCore.Momentumy">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Momentumy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Momentumy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentumup3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="AurelCore.Momentumz">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Momentumz">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Momentumz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentumup3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="AurelCore.Momentumdownx">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Momentumdownx">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Momentumdownx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentumdown3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="AurelCore.Momentumdowny">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Momentumdowny">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Momentumdowny</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentumdown3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="AurelCore.Momentumdownz">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Momentumdownz">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Momentumdownz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentumdown3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="AurelCore.Momentumup3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Momentumup3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Momentumup3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;Momentumx&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentumx&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentumy&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentumz&quot;</span><span class="p">]])</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CovD_term</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_covd</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kup3&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Ktrace&quot;</span><span class="p">],</span> <span class="s1">&#39;uu&#39;</span><span class="p">)</span>
            <span class="n">Mom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;bab... -&gt; a...&#39;</span><span class="p">,</span> <span class="n">CovD_term</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vacuum</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s1">&#39;Using vacuum shortcut for Momentumup3&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">Mom</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">Mom</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;fluxup3_n&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.Momentumdown3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Momentumdown3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Momentumdown3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ab..., b... -&gt; a...&#39;</span><span class="p">,</span> 
                         <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentumup3&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.Momentum_Escale">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Momentum_Escale">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Momentum_Escale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">DdKdd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_covd</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">],</span> <span class="s1">&#39;dd&#39;</span><span class="p">)</span>

        <span class="n">DKd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ab..., abc... -&gt; c...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="n">DdKdd</span><span class="p">)</span>
        <span class="n">DdK</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;bc..., abc... -&gt; a...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="n">DdKdd</span><span class="p">)</span>
        <span class="n">DKd2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;a..., ad..., d... -&gt; ...&#39;</span><span class="p">,</span> 
                         <span class="n">DKd</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="n">DKd</span><span class="p">)</span>
        <span class="n">DdK2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;a..., ad..., d... -&gt; ...&#39;</span><span class="p">,</span> 
                         <span class="n">DdK</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="n">DdK</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vacuum</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s1">&#39;Using vacuum shortcut for Momentum_Escale&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">DKd2</span> <span class="o">+</span> <span class="n">DdK2</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Eflux2</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">kappa</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                  <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;a..., a... -&gt; ...&#39;</span><span class="p">,</span> 
                              <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;fluxup3_n&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;fluxdown3_n&quot;</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">DKd2</span> <span class="o">+</span> <span class="n">DdK2</span> <span class="o">+</span> <span class="n">Eflux2</span><span class="p">))</span></div>

    
<div class="viewcode-block" id="AurelCore.Momentumx_norm">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Momentumx_norm">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Momentumx_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentumx&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentum_Escale&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.Momentumy_norm">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Momentumy_norm">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Momentumy_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentumy&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentum_Escale&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.Momentumz_norm">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Momentumz_norm">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Momentumz_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentumz&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentum_Escale&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.Momentumdownx_norm">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Momentumdownx_norm">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Momentumdownx_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentumdownx&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentum_Escale&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.Momentumdowny_norm">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Momentumdowny_norm">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Momentumdowny_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentumdowny&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentum_Escale&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.Momentumdownz_norm">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Momentumdownz_norm">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Momentumdownz_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentumdownz&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Momentum_Escale&quot;</span><span class="p">])</span></div>

    
    <span class="c1"># === Gravito-electromagnetism quantities</span>
<div class="viewcode-block" id="AurelCore.st_Weyl_down4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.st_Weyl_down4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">st_Weyl_down4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">if</span> <span class="s2">&quot;st_Riemann_down4&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>            
            <span class="n">Cdown</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Riemann_down4&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vacuum</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s1">&#39;Using vacuum shortcut for st_Weyl_down4&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">Cdown</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                                <span class="n">Cdown</span><span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">][</span><span class="n">a</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Ricci_down4&quot;</span><span class="p">][</span><span class="n">d</span><span class="p">,</span><span class="n">b</span><span class="p">]</span>
                        <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">][</span><span class="n">a</span><span class="p">,</span><span class="n">d</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Ricci_down4&quot;</span><span class="p">][</span><span class="n">c</span><span class="p">,</span><span class="n">b</span><span class="p">]</span>
                        <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">][</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Ricci_down4&quot;</span><span class="p">][</span><span class="n">d</span><span class="p">,</span><span class="n">a</span><span class="p">]</span>
                        <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">][</span><span class="n">b</span><span class="p">,</span><span class="n">d</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Ricci_down4&quot;</span><span class="p">][</span><span class="n">c</span><span class="p">,</span><span class="n">a</span><span class="p">])</span>
                <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_RicciS&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">][</span><span class="n">a</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">][</span><span class="n">d</span><span class="p">,</span><span class="n">b</span><span class="p">]</span>
                    <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">][</span><span class="n">a</span><span class="p">,</span><span class="n">d</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">][</span><span class="n">c</span><span class="p">,</span><span class="n">b</span><span class="p">]))</span>
                <span class="k">return</span> <span class="n">Cdown</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Endown4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_to_st</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;eweyl_n_down3&quot;</span><span class="p">])</span>
            <span class="n">Bndown4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_to_st</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;bweyl_n_down3&quot;</span><span class="p">])</span>
            <span class="n">ldown4</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">]</span> 
                      <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;a..., b... -&gt; ab...&#39;</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;ndown4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;ndown4&quot;</span><span class="p">]))</span>
            <span class="n">LCudd4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ec..., d..., dcab... -&gt; eab...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gup4&quot;</span><span class="p">],</span> 
                            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;nup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">levicivita_down4</span><span class="p">())</span>
                
            <span class="n">Cdown4</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ac..., db... -&gt; abcd...&#39;</span><span class="p">,</span> <span class="n">ldown4</span><span class="p">,</span> <span class="n">Endown4</span><span class="p">)</span>
                    <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ad..., cb... -&gt; abcd...&#39;</span><span class="p">,</span> <span class="n">ldown4</span><span class="p">,</span> <span class="n">Endown4</span><span class="p">))</span>
            <span class="n">Cdown4</span> <span class="o">-=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;bc..., da... -&gt; abcd...&#39;</span><span class="p">,</span> <span class="n">ldown4</span><span class="p">,</span> <span class="n">Endown4</span><span class="p">)</span>
                    <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;bd..., ca... -&gt; abcd...&#39;</span><span class="p">,</span> <span class="n">ldown4</span><span class="p">,</span> <span class="n">Endown4</span><span class="p">))</span>
            <span class="n">Cdown4</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;cde..., eab... -&gt; abcd...&#39;</span><span class="p">,</span>
                                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;c..., de... -&gt; cde...&#39;</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;ndown4&quot;</span><span class="p">],</span> <span class="n">Bndown4</span><span class="p">)</span>
                                <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;d..., ce... -&gt; cde...&#39;</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;ndown4&quot;</span><span class="p">],</span> <span class="n">Bndown4</span><span class="p">)),</span> <span class="n">LCudd4</span><span class="p">)</span>
            <span class="n">Cdown4</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;abe..., ecd... -&gt; abcd...&#39;</span><span class="p">,</span> 
                                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;a..., be... -&gt; abe...&#39;</span><span class="p">,</span> 
                                        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;ndown4&quot;</span><span class="p">],</span> <span class="n">Bndown4</span><span class="p">)</span> 
                                <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;b..., ae... -&gt; abe...&#39;</span><span class="p">,</span> 
                                            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;ndown4&quot;</span><span class="p">],</span> <span class="n">Bndown4</span><span class="p">)),</span> <span class="n">LCudd4</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Cdown4</span></div>

                   
<div class="viewcode-block" id="AurelCore.Weyl_Psi">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Weyl_Psi">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Weyl_Psi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;Weyl_Psi4r&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> 
                    <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Weyl_Psi4r&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Weyl_Psi4i&quot;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lup4</span><span class="p">,</span> <span class="n">kup4</span><span class="p">,</span> <span class="n">mup4</span><span class="p">,</span> <span class="n">mbup4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">null_vector_base</span><span class="p">()</span>
            <span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;abcd..., a..., b..., c..., d... -&gt; ...&#39;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Weyl_down4&quot;</span><span class="p">],</span> <span class="n">kup4</span><span class="p">,</span> <span class="n">mup4</span><span class="p">,</span> <span class="n">kup4</span><span class="p">,</span> <span class="n">mup4</span><span class="p">)</span>
            <span class="n">psi1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;abcd..., a..., b..., c..., d... -&gt; ...&#39;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Weyl_down4&quot;</span><span class="p">],</span> <span class="n">lup4</span><span class="p">,</span> <span class="n">kup4</span><span class="p">,</span> <span class="n">mup4</span><span class="p">,</span> <span class="n">kup4</span><span class="p">)</span>
            <span class="n">psi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;abcd..., a..., b..., c..., d... -&gt; ...&#39;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Weyl_down4&quot;</span><span class="p">],</span> <span class="n">kup4</span><span class="p">,</span> <span class="n">mup4</span><span class="p">,</span> <span class="n">mbup4</span><span class="p">,</span> <span class="n">lup4</span><span class="p">)</span>
            <span class="n">psi3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;abcd..., a..., b..., c..., d... -&gt; ...&#39;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Weyl_down4&quot;</span><span class="p">],</span> <span class="n">kup4</span><span class="p">,</span> <span class="n">lup4</span><span class="p">,</span> <span class="n">mbup4</span><span class="p">,</span> <span class="n">lup4</span><span class="p">)</span>
            <span class="n">psi4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;abcd..., a..., b..., c..., d... -&gt; ...&#39;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Weyl_down4&quot;</span><span class="p">],</span> <span class="n">lup4</span><span class="p">,</span> <span class="n">mbup4</span><span class="p">,</span> <span class="n">lup4</span><span class="p">,</span> <span class="n">mbup4</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">psi0</span><span class="p">,</span> <span class="n">psi1</span><span class="p">,</span> <span class="n">psi2</span><span class="p">,</span> <span class="n">psi3</span><span class="p">,</span> <span class="n">psi4</span><span class="p">]</span></div>

        
<div class="viewcode-block" id="AurelCore.Psi4_lm">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Psi4_lm">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Psi4_lm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum l of spherical decomposition is set to&quot;</span>
                     <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; AurelCore.lmax = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lmax</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extraction radii set to AurelCore.extract_radii&quot;</span>
                     <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">extract_radii</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Center of extraction sphere set to&quot;</span>
                     <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; AurelCore.center = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scipy interpolation method is set to&quot;</span>
                     <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; AurelCore.interp_method = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">interp_method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Uniform sampling of spherical points</span>
        <span class="c1"># Inclination points</span>
        <span class="n">Ntheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">Nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">Ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">Nz</span><span class="p">]),</span> 
                         <span class="bp">self</span><span class="o">.</span><span class="n">lmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">theta2_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">Ntheta</span><span class="o">+</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Ntheta</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dtheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">theta2_array</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># Azimuthal points</span>
        <span class="n">Nphi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Ntheta</span>
        <span class="n">phi2_array</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">Nphi</span><span class="o">+</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Nphi</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">phi2_array</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># 2D spherical grid</span>
        <span class="n">theta2</span><span class="p">,</span> <span class="n">phi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">theta2_array</span><span class="p">,</span> <span class="n">phi2_array</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
        
        <span class="c1"># Shift grid around sphere center</span>
        <span class="n">shifted_grid</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">xarray</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">yarray</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">zarray</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        
        <span class="c1"># For each extraction radius, interpolate Psi4 and decompose in</span>
        <span class="n">psi4lm</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">radius</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_radii</span><span class="p">:</span>
            
            <span class="c1"># Points on sphere</span>
            <span class="n">points_sphere</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">spherical_to_cartesian</span><span class="p">(</span>
                <span class="n">radius</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">phi2</span><span class="p">)</span>
            
            <span class="c1"># Interpolate Psi4 on sphere</span>
            <span class="n">psi4_sphere</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">numerical</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Weyl_Psi&quot;</span><span class="p">][</span><span class="mi">4</span><span class="p">]),</span> 
                    <span class="n">shifted_grid</span><span class="p">,</span>
                    <span class="n">points_sphere</span><span class="p">,</span> 
                    <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interp_method</span><span class="p">)</span>
                <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">numerical</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Weyl_Psi&quot;</span><span class="p">][</span><span class="mi">4</span><span class="p">]),</span> 
                    <span class="n">shifted_grid</span><span class="p">,</span>
                    <span class="n">points_sphere</span><span class="p">,</span> 
                    <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interp_method</span><span class="p">)</span>
                <span class="p">)</span>
            
            <span class="c1"># Spherical harmonic decomposition</span>
            <span class="n">psi4lm</span><span class="p">[</span><span class="n">radius</span><span class="p">]</span> <span class="o">=</span> <span class="n">maths</span><span class="o">.</span><span class="n">sYlm_coefficients</span><span class="p">(</span>
                <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmax</span><span class="p">,</span> <span class="n">psi4_sphere</span><span class="p">,</span> 
                <span class="n">theta2</span><span class="p">,</span> <span class="n">phi2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dtheta</span><span class="p">,</span> <span class="n">dphi</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">psi4lm</span></div>

    
<div class="viewcode-block" id="AurelCore.Weyl_invariants">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Weyl_invariants">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Weyl_invariants</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Psis</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Weyl_Psi&quot;</span><span class="p">]</span>
        <span class="n">I_inv</span> <span class="o">=</span> <span class="n">Psis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Psis</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">Psis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Psis</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">Psis</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">Psis</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">J_inv</span> <span class="o">=</span> <span class="n">maths</span><span class="o">.</span><span class="n">determinant3</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">Psis</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">Psis</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">Psis</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> 
                       <span class="p">[</span><span class="n">Psis</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">Psis</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Psis</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> 
                       <span class="p">[</span><span class="n">Psis</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Psis</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Psis</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s2">&quot;WARNING: I&#39;m not switching Psi0 and Psi4 here, &quot;</span>
                     <span class="o">+</span> <span class="s2">&quot;so the invariants are not correct if Psi4 = 0.&quot;</span>
                     <span class="o">+</span> <span class="s2">&quot;Same for Psi1 and Psi3.&quot;</span><span class="p">)</span>
        <span class="n">L_inv</span> <span class="o">=</span> <span class="n">Psis</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">Psis</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">Psis</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">K_inv</span> <span class="o">=</span> <span class="p">(</span><span class="n">Psis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">Psis</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> 
                 <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">Psis</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">Psis</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">Psis</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> 
                 <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">Psis</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">N_inv</span> <span class="o">=</span> <span class="mi">12</span><span class="o">*</span><span class="p">(</span><span class="n">L_inv</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Psis</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">I_inv</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="n">I_inv</span><span class="p">,</span> <span class="s1">&#39;J&#39;</span><span class="p">:</span> <span class="n">J_inv</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="n">L_inv</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="n">K_inv</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="n">N_inv</span><span class="p">}</span></div>

    
<div class="viewcode-block" id="AurelCore.eweyl_u_down4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.eweyl_u_down4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">eweyl_u_down4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;b..., d..., abcd... -&gt; ac...&#39;</span><span class="p">,</span> 
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;uup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;uup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Weyl_down4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.eweyl_n_down3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.eweyl_n_down3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">eweyl_n_down3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">KKterm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;ia..., bj..., ab... -&gt; ij...&#39;</span><span class="p">,</span> 
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">])</span>
        <span class="n">Edown</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracefree3</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Ricci_down3&quot;</span><span class="p">]</span>
                                <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Ktrace&quot;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">]</span>
                                <span class="o">-</span> <span class="n">KKterm</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vacuum</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="s1">&#39;Using vacuum shortcut for eweyl_n_down3&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Edown</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">Edown</span>
                    <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracefree3</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Stressdown3_n&quot;</span><span class="p">])</span>
                    <span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.bweyl_u_down4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.bweyl_u_down4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bweyl_u_down4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">LCuudd4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;ac..., bd..., abef... -&gt; cdef...&#39;</span><span class="p">,</span> 
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">levicivita_down4</span><span class="p">())</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;b..., f..., abcd..., cdef... -&gt; ae...&#39;</span><span class="p">,</span> 
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;uup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;uup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Weyl_down4&quot;</span><span class="p">],</span> <span class="n">LCuudd4</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.bweyl_n_down3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.bweyl_n_down3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bweyl_n_down3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">LCuud3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ae..., bf..., efc... -&gt; abc...&#39;</span><span class="p">,</span> 
                        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">levicivita_down3</span><span class="p">())</span>
        
        <span class="n">dKdown</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_covd</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">],</span> <span class="s1">&#39;dd&#39;</span><span class="p">)</span>
        <span class="n">Bterm1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;cdb..., cda... -&gt; ab...&#39;</span><span class="p">,</span> <span class="n">LCuud3</span><span class="p">,</span> <span class="n">dKdown</span><span class="p">)</span>

        <span class="n">Kmixed3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., jk... -&gt; ik...&#39;</span><span class="p">,</span> 
                            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">])</span>
        <span class="n">Bterm2K</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s_covd</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Ktrace&quot;</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> 
                <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ccb... -&gt; b...&#39;</span><span class="p">,</span> 
                            <span class="bp">self</span><span class="o">.</span><span class="n">s_covd</span><span class="p">(</span><span class="n">Kmixed3</span><span class="p">,</span> <span class="s1">&#39;ud&#39;</span><span class="p">)))</span>
        <span class="n">Bterm2</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;cdb..., ac..., d... -&gt; ab...&#39;</span><span class="p">,</span> <span class="n">LCuud3</span><span class="p">,</span> 
                        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">],</span> <span class="n">Bterm2K</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">Bterm1</span> <span class="o">+</span> <span class="n">Bterm2</span></div>

    
    <span class="c1">###########################################################################</span>

<div class="viewcode-block" id="AurelCore.null_ray_expansion">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.null_ray_expansion">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">null_ray_expansion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the expansion of null rays normal to a surface discribed F&quot;&quot;&quot;</span>
        <span class="n">dF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_scalar</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
        <span class="n">dFmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., i..., j... -&gt; ...&#39;</span><span class="p">,</span> 
                                        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="n">dF</span><span class="p">,</span> <span class="n">dF</span><span class="p">))</span>
        <span class="n">sup</span> <span class="o">=</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., j... -&gt; i...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="n">dF</span><span class="p">),</span>
            <span class="n">dFmag</span><span class="p">)</span>
        <span class="n">Disi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_div</span><span class="p">(</span><span class="n">sup</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">)</span>
        <span class="n">Kss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., i..., j... -&gt; ...&#39;</span><span class="p">,</span> 
                        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Kdown3&quot;</span><span class="p">],</span> <span class="n">sup</span><span class="p">,</span> <span class="n">sup</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;out&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Disi</span> <span class="o">+</span> <span class="n">Kss</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Ktrace&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;in&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span> <span class="n">Disi</span> <span class="o">+</span> <span class="n">Kss</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;Ktrace&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;direction must be &#39;out&#39; or &#39;in&#39;&quot;</span><span class="p">)</span></div>

    
    <span class="c1">###########################################################################</span>
    <span class="c1"># Tetrads</span>
    <span class="c1">###########################################################################</span>

<div class="viewcode-block" id="AurelCore.null_vector_base">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.null_vector_base">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">null_vector_base</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return an arbitrary null vector base.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        lup4, kup4, mup4, mbup4: list</span>
<span class="sd">            Each is (4, Nx, Ny, Nz) array_like complex</span>
<span class="sd">        </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        See &#39;Introduction to 3+1 Numerical Relativity&#39; 2008</span>
<span class="sd">        by M. Alcubierre page 295</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">e0up4</span><span class="p">,</span> <span class="n">e1up4</span><span class="p">,</span> <span class="n">e2up4</span><span class="p">,</span> <span class="n">e3up4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tetrad_base</span><span class="p">()</span>
        <span class="n">inverse_sqrt_2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">kup4</span> <span class="o">=</span> <span class="p">(</span><span class="n">e0up4</span> <span class="o">+</span> <span class="n">e1up4</span><span class="p">)</span> <span class="o">*</span> <span class="n">inverse_sqrt_2</span>
        <span class="n">lup4</span> <span class="o">=</span> <span class="p">(</span><span class="n">e0up4</span> <span class="o">-</span> <span class="n">e1up4</span><span class="p">)</span> <span class="o">*</span> <span class="n">inverse_sqrt_2</span>
        <span class="n">mup4</span> <span class="o">=</span> <span class="p">(</span><span class="n">e2up4</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">e3up4</span><span class="p">)</span> <span class="o">*</span> <span class="n">inverse_sqrt_2</span>
        <span class="n">mbup4</span> <span class="o">=</span> <span class="p">(</span><span class="n">e2up4</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">e3up4</span><span class="p">)</span> <span class="o">*</span> <span class="n">inverse_sqrt_2</span>
        <span class="k">return</span> <span class="n">lup4</span><span class="p">,</span> <span class="n">kup4</span><span class="p">,</span> <span class="n">mup4</span><span class="p">,</span> <span class="n">mbup4</span></div>


<div class="viewcode-block" id="AurelCore.tetrad_base">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.tetrad_base">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">tetrad_base</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return an quasi-Kinnersley or arbitrary tetrad base.</span>
<span class="sd">        </span>
<span class="sd">        if AurelCore.tetrad == &quot;quasi-Kinnersley&quot;:</span>
<span class="sd">            Which is the default, because the tetrad is set to</span>
<span class="sd">            &quot;quasi-Kinnersley&quot; in the init.</span>
<span class="sd">            Then quasi-Kinnersley tetrad is returned where the first tetrad</span>
<span class="sd">            is the normal to the hypersurface $n^\mu$.</span>
<span class="sd">        else:</span>
<span class="sd">            Then an arbitrary orthonormal tetrad is returned where </span>
<span class="sd">            the first tetrad is the fluid 4-velocity $u^\mu$.</span>
<span class="sd">    </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        e0up4, e1up4, e2up4, e3up4: list</span>
<span class="sd">            Each is (4, Nx, Ny, Nz) array_like</span>
<span class="sd">                   </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        - for Kinnersly tetrad see https://doi.org/10.1103/PhysRevD.65.044001 </span>
<span class="sd">          also see: </span>
<span class="sd">          Cactus/arrangements/EinsteinAnalysis/WeylScal4/m/WeylScal4.m </span>
<span class="sd">          Like the WeylScal4 thorn: tetrad given in wave zone (lapse = 1, </span>
<span class="sd">          shift = 0) and we do not perform the final rotation.</span>
<span class="sd">          Unlike the WeylScal4 thorn: I calc Weyl tensor in full (no wave zone </span>
<span class="sd">          assumption), but this gives the same result.</span>
<span class="sd">        - for Gram-Schmidt scheme see Chapter 7 of </span>
<span class="sd">          &#39;Linear Algebra, Theory and applications&#39; by W.Cheney and D.Kincaid</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tetrad is set to AurelCore.tetrad&quot;</span>
                     <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tetrad</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tetrad</span> <span class="o">==</span> <span class="s2">&quot;quasi-Kinnersley&quot;</span><span class="p">:</span>
            <span class="n">nup4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">),</span> 
                 <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">),</span>
                 <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">),</span>
                 <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)])</span>
            <span class="c1"># not self[&quot;nup4&quot;] because wave zone</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> 
                           <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">x</span><span class="p">))])</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">z</span><span class="p">])</span>
            <span class="n">LC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;a..., abcd... -&gt; bcd...&#39;</span><span class="p">,</span> 
                        <span class="n">nup4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">levicivita_down4</span><span class="p">())[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">v3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadet&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
                <span class="s1">&#39;ad..., dbc..., b..., c... -&gt; a...&#39;</span><span class="p">,</span>
                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="n">LC</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>

            <span class="c1"># Gram-Schmidt orthonormalization</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm3</span><span class="p">(</span><span class="n">v1</span><span class="p">))</span>

            <span class="n">v2</span> <span class="o">=</span> <span class="n">v2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_inner_product3</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="o">*</span> <span class="n">v1</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm3</span><span class="p">(</span><span class="n">v2</span><span class="p">))</span>

            <span class="n">v3</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_inner_product3</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v3</span><span class="p">)</span> <span class="o">*</span> <span class="n">v1</span> 
                <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_inner_product3</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">)</span> <span class="o">*</span> <span class="n">v2</span><span class="p">)</span>
            <span class="n">v3</span> <span class="o">=</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm3</span><span class="p">(</span><span class="n">v3</span><span class="p">))</span>

            
            <span class="n">e0up4</span> <span class="o">=</span> <span class="n">nup4</span>
            <span class="n">e1up4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">),</span> <span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v2</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
            <span class="c1"># typo in ref paper</span>
            <span class="n">e2up4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">),</span> <span class="n">v3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v3</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
            <span class="n">e3up4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">),</span> <span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v1</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># this is just an arbitrary orthonormal tetrad base</span>
            <span class="n">zeros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">zeros</span><span class="p">,</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])),</span> <span class="n">zeros</span><span class="p">,</span> <span class="n">zeros</span><span class="p">])</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">zeros</span><span class="p">,</span> <span class="n">zeros</span><span class="p">,</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])),</span> <span class="n">zeros</span><span class="p">])</span>
            <span class="n">v3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">zeros</span><span class="p">,</span> <span class="n">zeros</span><span class="p">,</span> <span class="n">zeros</span><span class="p">,</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]))])</span>

            <span class="n">e0up4</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;uup4&quot;</span><span class="p">]</span>
            
            <span class="n">u1</span> <span class="o">=</span> <span class="n">v1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_inner_product4</span><span class="p">(</span><span class="n">e0up4</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span> <span class="o">*</span> <span class="n">e0up4</span>
            <span class="n">e1up4</span> <span class="o">=</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm4</span><span class="p">(</span><span class="n">u1</span><span class="p">))</span>
            
            <span class="n">u2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_inner_product4</span><span class="p">(</span><span class="n">e0up4</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="o">*</span> <span class="n">e0up4</span> 
                <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_inner_product4</span><span class="p">(</span><span class="n">e1up4</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="o">*</span> <span class="n">e1up4</span><span class="p">)</span>
            <span class="n">e2up4</span> <span class="o">=</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span><span class="n">u2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm4</span><span class="p">(</span><span class="n">u2</span><span class="p">))</span>
            
            <span class="n">u3</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_inner_product4</span><span class="p">(</span><span class="n">e0up4</span><span class="p">,</span> <span class="n">v3</span><span class="p">)</span> <span class="o">*</span> <span class="n">e0up4</span> 
                <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_inner_product4</span><span class="p">(</span><span class="n">e1up4</span><span class="p">,</span> <span class="n">v3</span><span class="p">)</span> <span class="o">*</span> <span class="n">e1up4</span>
                <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_inner_product4</span><span class="p">(</span><span class="n">e2up4</span><span class="p">,</span> <span class="n">v3</span><span class="p">)</span> <span class="o">*</span> <span class="n">e2up4</span><span class="p">)</span>
            <span class="n">e3up4</span> <span class="o">=</span> <span class="n">maths</span><span class="o">.</span><span class="n">safe_division</span><span class="p">(</span><span class="n">u3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm4</span><span class="p">(</span><span class="n">u3</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">e0up4</span><span class="p">,</span> <span class="n">e1up4</span><span class="p">,</span> <span class="n">e2up4</span><span class="p">,</span> <span class="n">e3up4</span></div>

    
    <span class="c1">###########################################################################</span>
    <span class="c1"># Derivatives</span>
    <span class="c1">###########################################################################</span>
    
<div class="viewcode-block" id="AurelCore.s_covd">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.s_covd">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">s_covd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indexing</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Spatial covariant derivative of a 3D tensor of rank 0, 1 or 2.</span>
<span class="sd">        </span>
<span class="sd">        Covariant derivative with respects to the spatial metric.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ---------- </span>
<span class="sd">        f : (..., Nx, Ny, Nz) array_like</span>
<span class="sd">            Tensor of rank 0, 1 or 2. The first indices are the spatial ones.</span>
<span class="sd">        indexing : str</span>
<span class="sd">            &#39;&#39; for scalar,</span>
<span class="sd">            &#39;u&#39; for upper index, &#39;d&#39; for down index,</span>
<span class="sd">            &#39;uu&#39; for two upper indices, &#39;dd&#39; for two down indices,</span>
<span class="sd">            &#39;ud&#39; for one upper and one down index</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        (3, ..., Nx, Ny, Nz) array_like</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rank</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexing</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">covd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_scalar</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_rank1tensor</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;u&#39;</span><span class="p">:</span>
                <span class="n">G1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;abc..., b... -&gt; ca...&#39;</span><span class="p">,</span> 
                               <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
                <span class="n">G1</span> <span class="o">=</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;abc..., a... -&gt; bc...&#39;</span><span class="p">,</span> 
                                 <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Field if of rank </span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2"> so indexing&quot;</span>
                                 <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; must be &#39;u&#39; or &#39;d&#39;&quot;</span><span class="p">)</span>
            <span class="n">covd</span> <span class="o">=</span> <span class="n">df</span> <span class="o">+</span> <span class="n">G1</span>
        <span class="k">elif</span> <span class="n">rank</span> <span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_rank2tensor</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;uu&#39;</span><span class="p">:</span>
                <span class="n">G1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;acd..., db... -&gt; cab...&#39;</span><span class="p">,</span> 
                               <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
                <span class="n">G2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;bcd..., ad... -&gt; cab...&#39;</span><span class="p">,</span> 
                               <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;dd&#39;</span><span class="p">:</span>
                <span class="n">G1</span> <span class="o">=</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;dca..., db... -&gt; cab...&#39;</span><span class="p">,</span> 
                                 <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
                <span class="n">G2</span> <span class="o">=</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;dcb..., ad... -&gt; cab...&#39;</span><span class="p">,</span> 
                                 <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;ud&#39;</span><span class="p">:</span>
                <span class="n">G1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;acd..., db... -&gt; cab...&#39;</span><span class="p">,</span> 
                               <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
                <span class="n">G2</span> <span class="o">=</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;dcb..., ad... -&gt; cab...&#39;</span><span class="p">,</span> 
                                 <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;du&#39;</span><span class="p">:</span>
                <span class="n">G1</span> <span class="o">=</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;dca..., db... -&gt; cab...&#39;</span><span class="p">,</span> 
                                 <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
                <span class="n">G2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;bcd..., ad... -&gt; cab...&#39;</span><span class="p">,</span> 
                               <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;s_Gamma_udd3&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Field if of rank </span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2"> so indexing&quot;</span>
                                 <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; must be &#39;uu&#39;, &#39;ud&#39;, &#39;du&#39; or &#39;dd&#39;&quot;</span><span class="p">)</span>
            <span class="n">covd</span> <span class="o">=</span> <span class="n">df</span> <span class="o">+</span> <span class="n">G1</span> <span class="o">+</span> <span class="n">G2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Don&#39;t know how to compute spatial covariant&quot;</span>
                             <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; derivative of rank </span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">covd</span></div>

    
<div class="viewcode-block" id="AurelCore.st_covd">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.st_covd">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">st_covd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">dtf</span><span class="p">,</span> <span class="n">indexing</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Spacetime covariant derivative of a 4D tensor of rank 0 or 1.</span>
<span class="sd">        </span>
<span class="sd">        Covariant derivative with respects to the spacetime metric.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ---------- </span>
<span class="sd">        f : (..., Nx, Ny, Nz) array_like</span>
<span class="sd">            Tensor of rank 0, or 1. The first indices are the spacetime ones.</span>
<span class="sd">        dtf : (..., Nx, Ny, Nz) array_like</span>
<span class="sd">            Time derivative of the tensor. This array must have the same shape.</span>
<span class="sd">        indexing : str</span>
<span class="sd">            &#39;&#39; for scalar</span>
<span class="sd">            &#39;u&#39; for upper index, &#39;d&#39; for down index</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        (4, ...., Nx, Ny, Nz) array_like</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rank</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexing</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">covd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dtf</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_scalar</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dtf</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_rank1tensor</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> 
                           <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
                <span class="n">G1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;abc..., b... -&gt; ca...&#39;</span><span class="p">,</span> 
                               <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Gamma_udd4&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;u&#39;</span><span class="p">:</span>
                <span class="n">G1</span> <span class="o">=</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;abc..., a... -&gt; bc...&#39;</span><span class="p">,</span> 
                                 <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;st_Gamma_udd4&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Field if of rank </span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2"> so indexing&quot;</span><span class="o">+</span>
                                 <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; must be &#39;u&#39; or &#39;d&#39;&quot;</span><span class="p">)</span>
            <span class="n">covd</span> <span class="o">=</span> <span class="n">df</span> <span class="o">+</span> <span class="n">G1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Don&#39;t know how to compute spacetime covariant&quot;</span><span class="o">+</span>
                             <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; derivative of rank </span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">covd</span></div>

    
<div class="viewcode-block" id="AurelCore.s_div">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.s_div">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">s_div</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indexing</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute divergence along n of a 3D tensor of rank 1 or 2.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ---------- </span>
<span class="sd">        f : </span>
<span class="sd">            if rank 1: (3, Nx, Ny, Nz) array_like,</span>
<span class="sd">            if rank 2: (3, 3, Nx, Ny, Nz) array_like</span>
<span class="sd">        indexing : str</span>
<span class="sd">            &#39;u&#39; for upper index, &#39;d&#39; for down index</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        if rank 1 (Nx, Ny, Nz) array_like</span>
<span class="sd">        if rank 2 (3, Nx, Ny, Nz) array_like</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">covd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_covd</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">indexing</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;u&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;aa... -&gt; ...&#39;</span><span class="p">,</span> <span class="n">covd</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ab..., ab... -&gt; ...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="n">covd</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;uu&#39;</span> <span class="ow">or</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;ud&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;aab... -&gt; b...&#39;</span><span class="p">,</span> <span class="n">covd</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;du&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;aba... -&gt; b...&#39;</span><span class="p">,</span> <span class="n">covd</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;dd&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ab..., abc... -&gt; c...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="n">covd</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Don&#39;t know how to compute divergence of tensor&quot;</span><span class="o">+</span>
                             <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; with indices </span><span class="si">{</span><span class="n">indexing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.s_curl">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.s_curl">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">s_curl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fdown3</span><span class="p">,</span> <span class="n">indexing</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute curl along n of a 3D rank 2 covariant tensor.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ---------- </span>
<span class="sd">        fdown3 : (3, 3, Nx, Ny, Nz) array_like</span>
<span class="sd">            Rank 2 spatial tensor with both indices down</span>
<span class="sd">        indexing : str</span>
<span class="sd">            only accepts &#39;dd&#39; for two down indices</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        (3, 3, Nx, Ny, Nz) array_like</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">covd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_covd</span><span class="p">(</span><span class="n">fdown3</span><span class="p">,</span> <span class="n">indexing</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;dd&#39;</span><span class="p">:</span>
            <span class="n">LCuud3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ae..., bf..., d..., defc... -&gt; abc...&#39;</span><span class="p">,</span> 
                            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;nup4&quot;</span><span class="p">],</span> 
                            <span class="bp">self</span><span class="o">.</span><span class="n">levicivita_down4</span><span class="p">())[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span>
            <span class="n">curl</span> <span class="o">=</span> <span class="n">maths</span><span class="o">.</span><span class="n">symmetrise_tensor</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;cda..., cbd... -&gt; ab...&#39;</span><span class="p">,</span> 
                          <span class="n">LCuud3</span><span class="p">,</span> <span class="n">covd</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Don&#39;t know how to compute curl of tensor&quot;</span><span class="o">+</span>
                             <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; with indices </span><span class="si">{</span><span class="n">indexing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">curl</span></div>

    
<div class="viewcode-block" id="AurelCore.Lie_beta">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.Lie_beta">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Lie_beta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indexing</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the Lie derivative along the shift vector.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        f : array_like</span>
<span class="sd">            The field to differentiate. Can be a scalar, vector, or rank-2 </span>
<span class="sd">            tensor, with shape corresponding to `indexing`.</span>
<span class="sd">        indexing : str</span>
<span class="sd">            String describing the type and index structure of `f`. </span>
<span class="sd">            Must be one of::</span>
<span class="sd">                </span>
<span class="sd">                - &#39;&#39;     : scalar</span>
<span class="sd">                - &#39;s_u&#39;  : spatial vector, upper index</span>
<span class="sd">                - &#39;st_u&#39; : spacetime vector, upper index</span>
<span class="sd">                - &#39;s_d&#39;  : spatial vector, lower index</span>
<span class="sd">                - &#39;st_d&#39; : spacetime vector, lower index</span>
<span class="sd">                - &#39;s_uu&#39; : spatial rank-2 tensor, both indices up</span>
<span class="sd">                - &#39;s_ud&#39; : spatial rank-2 tensor, first up, second down</span>
<span class="sd">                - &#39;s_du&#39; : spatial rank-2 tensor, first down, second up</span>
<span class="sd">                - &#39;s_dd&#39; : spatial rank-2 tensor, both indices down</span>

<span class="sd">        weight : int or float, optional</span>
<span class="sd">            Weight for the density correction term (default: 0). </span>
<span class="sd">            If nonzero, adds `weight * div(beta) * f` to the result, </span>
<span class="sd">            where `div(beta)` is the divergence of the shift vector.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Lie : array_like</span>
<span class="sd">            The Lie derivative of `f` along ^i, with the same shape as `f`.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Input checks</span>
        <span class="k">if</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">rank</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(((</span><span class="s1">&#39;s_&#39;</span> <span class="ow">in</span> <span class="n">indexing</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;st_&#39;</span> <span class="ow">in</span> <span class="n">indexing</span><span class="p">))</span> 
                <span class="ow">and</span> <span class="p">(</span><span class="n">indexing</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="n">s_or_st</span> <span class="o">=</span> <span class="n">indexing</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="n">indexing</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">rank</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rank</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Haven&#39;t implemented Lie derivative along beta&quot;</span>
                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; for tensor of rank </span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;indexing must be &#39;u&#39; or &#39;d&#39; not </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">s_or_st</span> <span class="o">==</span> <span class="s1">&#39;st&#39;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                        <span class="s2">&quot;Haven&#39;t implemented Lie derivative along beta&quot;</span>
                        <span class="o">+</span> <span class="s2">&quot; for rank 2 spacetime tensor&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;indexing must be &#39;&#39; or contain &#39;s_&#39; or &#39;st_&#39;&quot;</span><span class="p">)</span>
            
            <span class="c1"># Check shape of f</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;st&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rank</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">dim</span><span class="p">[</span><span class="n">s_or_st</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;In Lie derivative along beta, you say f is&quot;</span>
                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">indexing</span><span class="si">}</span><span class="s2">, so rank </span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2"> with dim&quot;</span>
                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">dim</span><span class="p">[</span><span class="n">s_or_st</span><span class="p">]</span><span class="si">}</span><span class="s2">, but f is of shape </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">Lie</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;a..., a... -&gt; ...&#39;</span><span class="p">,</span> 
                            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_scalar</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">betaupdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i..., ij... -&gt; j...&#39;</span><span class="p">,</span> 
                                  <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_rank1tensor</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
            <span class="n">dbetaup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_rank1tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;s_u&#39;</span><span class="p">:</span>
                <span class="n">Lie</span> <span class="o">=</span> <span class="n">betaupdf</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., i... -&gt; j...&#39;</span><span class="p">,</span> <span class="n">dbetaup</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;st_u&#39;</span><span class="p">:</span>
                <span class="n">Lie_t</span> <span class="o">=</span> <span class="p">(</span><span class="n">betaupdf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># Bcs beta^t = 0</span>
                <span class="n">Lie_s</span> <span class="o">=</span> <span class="p">(</span><span class="n">betaupdf</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;dtbetaup3&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                          <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., i... -&gt; j...&#39;</span><span class="p">,</span> <span class="n">dbetaup</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
                <span class="n">Lie</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Lie_t</span><span class="p">,</span> <span class="n">Lie_s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Lie_s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Lie_s</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
            <span class="k">elif</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;s_d&#39;</span><span class="p">:</span>
                <span class="n">Lie</span> <span class="o">=</span> <span class="n">betaupdf</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij..., j... -&gt; i...&#39;</span><span class="p">,</span> <span class="n">dbetaup</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># &#39;st_d&#39;</span>
                <span class="n">Lie_t</span> <span class="o">=</span> <span class="p">(</span><span class="n">betaupdf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
                    <span class="s1">&#39;j..., j... -&gt; ...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;dtbetaup3&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
                <span class="n">Lie_s</span> <span class="o">=</span> <span class="p">(</span><span class="n">betaupdf</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
                    <span class="s1">&#39;ij..., j... -&gt; i...&#39;</span><span class="p">,</span> <span class="n">dbetaup</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
                <span class="n">Lie</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Lie_t</span><span class="p">,</span> <span class="n">Lie_s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Lie_s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Lie_s</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">betaupdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;s..., sjk... -&gt; jk...&#39;</span><span class="p">,</span> 
                             <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_rank2tensor</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
            <span class="n">dbetaup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3_rank1tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;s_uu&#39;</span><span class="p">:</span>
                <span class="n">Lie</span> <span class="o">=</span> <span class="p">(</span><span class="n">betaupdf</span> 
                       <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;sj..., sk... -&gt; jk...&#39;</span><span class="p">,</span> <span class="n">dbetaup</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                       <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;sk..., js... -&gt; jk...&#39;</span><span class="p">,</span> <span class="n">dbetaup</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
            <span class="c1">#elif indexing == &#39;st_uu&#39;:</span>
            <span class="c1">#    Lie = (betaupdf - ... - ...)</span>
            <span class="k">elif</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;s_ud&#39;</span><span class="p">:</span>
                <span class="n">Lie</span> <span class="o">=</span> <span class="p">(</span><span class="n">betaupdf</span> 
                       <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;sj..., sk... -&gt; jk...&#39;</span><span class="p">,</span> <span class="n">dbetaup</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                       <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ks..., js... -&gt; jk...&#39;</span><span class="p">,</span> <span class="n">dbetaup</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
            <span class="c1">#elif indexing == &#39;st_ud&#39;:</span>
            <span class="c1">#    Lie = (betaupdf - ... + ...)</span>
            <span class="k">elif</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;s_du&#39;</span><span class="p">:</span>
                <span class="n">Lie</span> <span class="o">=</span> <span class="p">(</span><span class="n">betaupdf</span> 
                       <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;js..., sk... -&gt; jk...&#39;</span><span class="p">,</span> <span class="n">dbetaup</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                       <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;sk..., js... -&gt; jk...&#39;</span><span class="p">,</span> <span class="n">dbetaup</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
            <span class="c1">#elif indexing == &#39;st_du&#39;:</span>
            <span class="c1">#    Lie = (betaupdf + ... - ...)</span>
            <span class="k">elif</span> <span class="n">indexing</span> <span class="o">==</span> <span class="s1">&#39;s_dd&#39;</span><span class="p">:</span>
                <span class="n">Lie</span> <span class="o">=</span> <span class="p">(</span><span class="n">betaupdf</span> 
                       <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;js..., sk... -&gt; jk...&#39;</span><span class="p">,</span> <span class="n">dbetaup</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                       <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ks..., js... -&gt; jk...&#39;</span><span class="p">,</span> <span class="n">dbetaup</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
            <span class="c1">#else: # &#39;st_dd&#39;</span>
            <span class="c1">#    Lie = (betaupdf + ... + ...)</span>

        <span class="k">if</span> <span class="n">weight</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">divb</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3x</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3y</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">d3z</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">Lie</span> <span class="o">+=</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">divb</span> <span class="o">*</span> <span class="n">f</span>
        
        <span class="k">return</span> <span class="n">Lie</span></div>

    
    <span class="c1">###########################################################################</span>
    <span class="c1"># Tensorial operations</span>
    <span class="c1">###########################################################################</span>

<div class="viewcode-block" id="AurelCore.s_to_st">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.s_to_st">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">s_to_st</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fdown3</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute spacetime tensor from the spatial tensor.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------  </span>
<span class="sd">        fdown3 : (3, 3, Nx, Ny, Nz) array_like</span>
<span class="sd">            Rank 2 spatial tensor with both indices down</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fdown4 : (4, 4, Nx, Ny, Nz) array_like</span>
<span class="sd">            Rank 2 spacetime tensor with both indices down</span>
<span class="sd">            </span>
<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        By definition the electric part of the Weyl tensor in the $n^\mu$</span>
<span class="sd">        frame with indices up, ${}^{(n)}E^{\alpha \beta}$, </span>
<span class="sd">        only has spatial components, same for the magnetic part, </span>
<span class="sd">        ${}^{(n)}B^{\alpha \beta}$, and the extrinsic curvature, </span>
<span class="sd">        $K^{\alpha\beta}$. </span>
<span class="sd">        So this function only applied to those three tensors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;betaup3&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;betax&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">myprint</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Using $\beta^i = 0$ shortcut for s_to_st&quot;</span><span class="p">)</span>
            <span class="n">f00</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span>
            <span class="n">f0k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Nx&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Ny&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Nz&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f00</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i..., j..., ij... -&gt; ...&#39;</span><span class="p">,</span> 
                            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">],</span> <span class="n">fdown3</span><span class="p">)</span>
            <span class="n">f0k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i..., ik... -&gt; k...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;betaup3&quot;</span><span class="p">],</span> <span class="n">fdown3</span><span class="p">)</span>
        <span class="n">fdown4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">f00</span><span class="p">,</span> <span class="n">f0k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f0k</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">f0k</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                           <span class="p">[</span><span class="n">f0k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fdown3</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">fdown3</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">fdown3</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
                           <span class="p">[</span><span class="n">f0k</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fdown3</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">fdown3</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">fdown3</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
                           <span class="p">[</span><span class="n">f0k</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">fdown3</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">fdown3</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">fdown3</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]])</span>
        <span class="k">return</span> <span class="n">fdown4</span></div>

    
<div class="viewcode-block" id="AurelCore.vector_inner_product4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.vector_inner_product4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">vector_inner_product4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Inner product of rank 1 4D tensors with indices up.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;a..., b..., ab... -&gt; ...&#39;</span><span class="p">,</span> 
                         <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdown4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.vector_inner_product3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.vector_inner_product3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">vector_inner_product3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Inner product of rank 1 3D tensors with indices up.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;a..., b..., ab... -&gt; ...&#39;</span><span class="p">,</span> 
                         <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">])</span></div>


<div class="viewcode-block" id="AurelCore.trace4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.trace4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">trace4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fdown4</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute trace of a 4D rank 2 tensor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;jk..., jk... -&gt; ...&#39;</span><span class="p">,</span> 
                         <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gup4&quot;</span><span class="p">],</span> <span class="n">fdown4</span><span class="p">)</span></div>


<div class="viewcode-block" id="AurelCore.trace3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.trace3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">trace3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fdown3</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute trace of a 3D rank 2 tensor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;jk..., jk... -&gt; ...&#39;</span><span class="p">,</span> 
                         <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="n">fdown3</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.tracefree3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.tracefree3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">tracefree3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fdown3</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute tracefree part of a 3D rank 2 tensor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">fdown3</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadown3&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace3</span><span class="p">(</span><span class="n">fdown3</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AurelCore.magnitude4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.magnitude4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">magnitude4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fdown</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute magnitude of a 4D rank 2 tensor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;ab..., ij..., ai..., bj... -&gt; ...&#39;</span><span class="p">,</span> 
            <span class="n">fdown</span><span class="p">,</span> <span class="n">fdown</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gup4&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gup4&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.magnitude3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.magnitude3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">magnitude3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fdown</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute magnitude of a 3D rank 2 tensor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;ab..., ij..., ai..., bj... -&gt; ...&#39;</span><span class="p">,</span> 
            <span class="n">fdown</span><span class="p">,</span> <span class="n">fdown</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammaup3&quot;</span><span class="p">])</span></div>

    
<div class="viewcode-block" id="AurelCore.norm4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.norm4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">norm4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute norm of a 4D rank 1 tensor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vector_inner_product4</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">)))</span></div>

    
<div class="viewcode-block" id="AurelCore.norm3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.norm3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">norm3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute norm of a 3D rank 1 tensor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vector_inner_product3</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">)))</span></div>

    
<div class="viewcode-block" id="AurelCore.kronecker_delta4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.kronecker_delta4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">kronecker_delta4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute Kronecker delta with 4 4D indices.&quot;&quot;&quot;</span>
        <span class="n">kronecker</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Nx&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Ny&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Nz&#39;</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">kronecker</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">return</span> <span class="n">kronecker</span></div>

    
<div class="viewcode-block" id="AurelCore.kronecker_delta3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.kronecker_delta3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">kronecker_delta3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute Kronecker delta with 3 3D indices.&quot;&quot;&quot;</span>
        <span class="n">kronecker</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Nx&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Ny&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Nz&#39;</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">kronecker</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">return</span> <span class="n">kronecker</span></div>


<div class="viewcode-block" id="AurelCore.levicivita_down4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.levicivita_down4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">levicivita_down4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute Levi-Civita tensor with 4 4D indices down.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levicivita_symbol_down4</span><span class="p">()</span> 
                <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gdet&quot;</span><span class="p">]))</span></div>

    
<div class="viewcode-block" id="AurelCore.levicivita_down3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.levicivita_down3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">levicivita_down3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute Levi-Civita tensor with 3 3D indices down.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levicivita_symbol_down3</span><span class="p">()</span> 
                <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gammadet&quot;</span><span class="p">]))</span></div>


<div class="viewcode-block" id="AurelCore.levicivita_symbol_down4">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.levicivita_symbol_down4">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">levicivita_symbol_down4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute Levi-Civita symbol with 4 4D indices down.&quot;&quot;&quot;</span>
        <span class="n">LC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Nx&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Ny&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Nz&#39;</span><span class="p">]))</span>
        <span class="n">allindices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i0</span> <span class="ow">in</span> <span class="n">allindices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">allindices</span><span class="p">,</span> <span class="n">i0</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i2</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">allindices</span><span class="p">,</span> <span class="p">[</span><span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">]):</span>
                    <span class="k">for</span> <span class="n">i3</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">allindices</span><span class="p">,</span> <span class="p">[</span><span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">]):</span>
                        <span class="n">top</span> <span class="o">=</span> <span class="p">((</span><span class="n">i1</span><span class="o">-</span><span class="n">i0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i2</span><span class="o">-</span><span class="n">i0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i3</span><span class="o">-</span><span class="n">i0</span><span class="p">)</span> 
                               <span class="o">*</span> <span class="p">(</span><span class="n">i2</span><span class="o">-</span><span class="n">i1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i3</span><span class="o">-</span><span class="n">i1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i3</span><span class="o">-</span><span class="n">i2</span><span class="p">))</span>
                        <span class="n">bot</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">i1</span><span class="o">-</span><span class="n">i0</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i2</span><span class="o">-</span><span class="n">i0</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i3</span><span class="o">-</span><span class="n">i0</span><span class="p">)</span>
                               <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i2</span><span class="o">-</span><span class="n">i1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i3</span><span class="o">-</span><span class="n">i1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i3</span><span class="o">-</span><span class="n">i2</span><span class="p">))</span>
                        <span class="n">LC</span><span class="p">[</span><span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">i3</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">top</span><span class="o">/</span><span class="n">bot</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">LC</span></div>


<div class="viewcode-block" id="AurelCore.levicivita_symbol_down3">
<a class="viewcode-back" href="../../source/core.html#aurel.core.AurelCore.levicivita_symbol_down3">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">levicivita_symbol_down3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute Levi-Civita symbol with 3 3D indices down.&quot;&quot;&quot;</span>
        <span class="n">LC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Nx&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Ny&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Nz&#39;</span><span class="p">]))</span>
        <span class="n">allindices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="n">allindices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i2</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">allindices</span><span class="p">,</span> <span class="n">i1</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i3</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">allindices</span><span class="p">,</span> <span class="p">[</span><span class="n">i1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i2</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">top</span> <span class="o">=</span> <span class="p">((</span><span class="n">i2</span><span class="o">-</span><span class="n">i1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i3</span><span class="o">-</span><span class="n">i1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i3</span><span class="o">-</span><span class="n">i2</span><span class="p">))</span>
                    <span class="n">bot</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">i2</span><span class="o">-</span><span class="n">i1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i3</span><span class="o">-</span><span class="n">i1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i3</span><span class="o">-</span><span class="n">i2</span><span class="p">))</span>
                    <span class="n">LC</span><span class="p">[</span><span class="n">i1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i3</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">top</span><span class="o">/</span><span class="n">bot</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">LC</span></div>
</div>


<span class="c1"># Update __doc__ of the functions listed in descriptions</span>
<span class="k">for</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">descriptions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">AurelCore</span><span class="p">,</span> <span class="n">func_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">doc</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Robyn L. Munoz.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>